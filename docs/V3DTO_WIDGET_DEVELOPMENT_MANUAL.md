# V3DTO Widget Development Manual

## –û–±–∑–æ—Ä

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –≤–∏–¥–∂–µ—Ç–æ–≤ –≤ Renderer v3dto. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∫–∞–∫ –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ UI.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –û—Å–Ω–æ–≤—ã

### DTO –ò–∑–æ–ª—è—Ü–∏—è (Data Transfer Objects)

**–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø**: –í–∏–¥–∂–µ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç **—Ç–æ–ª—å–∫–æ** —Å –¥–∞–Ω–Ω—ã–º–∏, –æ–Ω–∏ **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏–Ω–≥–ª—å—Ç–æ–Ω–∞–º.

```
Domain Layer          Presentation Layer
(world, logger)   ‚Üí   DTO containers   ‚Üí   Widgets
(singletons)          (data only)           (pure UI)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤–∏–¥–∂–µ—Ç–æ–≤ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã (–º–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ DTO)
- ‚úÖ –í–∏–¥–∂–µ—Ç—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è UI

### RenderStateDTO - –ì–ª–∞–≤–Ω—ã–π –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä

–í—Å–µ –≤–∏–¥–∂–µ—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π `RenderStateDTO`:

```python
@dataclass
class RenderStateDTO:
    world: WorldStateDTO              # –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏—Ä–∞
    params: SimulationParamsDTO       # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏–º—É–ª—è—Ü–∏–∏
    debug: DebugDataDTO               # –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    selected_creature: Optional[...]  # –í—ã–±—Ä–∞–Ω–Ω–æ–µ —Å—É—â–µ—Å—Ç–≤–æ + –∏—Å—Ç–æ—Ä–∏—è
    current_state: str                # –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (main, modal, etc.)
    tick: int                         # –ù–æ–º–µ—Ä —Ç–∏–∫–∞
    fps: int                          # FPS —Å—á–µ—Ç—á–∏–∫
```

**–í–∏–¥–∂–µ—Ç –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç:**
- ‚ùå `world` (singleton)
- ‚ùå `logger` (singleton)
- ‚ùå `debugger` (singleton)
- ‚ùå `simparams` (singleton)

**–í–∏–¥–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ:**
- ‚úÖ `pygame`
- ‚úÖ `numpy` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- ‚úÖ DTO –∫–ª–∞—Å—Å—ã –∏–∑ `renderer.v3dto.dto`

---

## üìã –û–±—â–∏–µ –ß–µ—Ä—Ç—ã –í—Å–µ—Ö –í–∏–¥–∂–µ—Ç–æ–≤

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ö–ª–∞—Å—Å–∞

–í—Å–µ –≤–∏–¥–∂–µ—Ç—ã —Å–ª–µ–¥—É—é—Ç –æ–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

```python
class WidgetName:
    # 1Ô∏è‚É£ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (class constants)
    WIDGET_X = 10
    WIDGET_Y = 10
    WIDTH = 200
    HEIGHT = 100
    
    FONT_SIZE = 14
    FONT_PATH = './tests/Ac437_Siemens_PC-D.ttf'
    
    COLORS = {
        'background': (30, 30, 30),
        'border': (150, 150, 150),
        'text': (200, 200, 200),
    }
    
    # 2Ô∏è‚É£ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (–±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
    def __init__(self):
        # –°–æ–∑–¥–∞—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—é
        self.rect = pygame.Rect(self.WIDGET_X, self.WIDGET_Y, 
                                self.WIDTH, self.HEIGHT)
        
        # –°–æ–∑–¥–∞—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
        self.surface = pygame.Surface((self.WIDTH, self.HEIGHT), pygame.SRCALPHA)
        

    
    # 3Ô∏è‚É£ –û–¢–†–ò–°–û–í–ö–ê (–ø–æ–ª—É—á–∞–µ—Ç RenderStateDTO)
    def draw(self, screen: pygame.Surface, render_state: RenderStateDTO) -> None:
        """–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–∏–¥–∂–µ—Ç–∞."""
        # –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å
        self.surface.fill(self.COLORS['background'])
        
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ render_state
        # ... –≤–∞—à –∫–æ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ ...
        
        # –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        screen.blit(self.surface, (self.rect.x, self.rect.y))
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –ú–∏–Ω–∏–º—É–º –ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–ü—Ä–∞–≤–∏–ª–æ**: `__init__()` –ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

‚úÖ **–•–æ—Ä–æ—à–æ:**
```python
def __init__(self):
    self.rect = pygame.Rect(...)
    self.surface = pygame.Surface(...)
    self.font = pygame.font.Font(...)
```

‚úÖ **–î–æ–ø—É—Å—Ç–∏–º–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è callback):**
```python
def __init__(self, on_parameter_change: Callable[[str, Any], None]):
    self.on_parameter_change = on_parameter_change  # Callback –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–µ ...
```

‚ùå **–ü–ª–æ—Ö–æ:**
```python
def __init__(self, world, logger, debugger):  # ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏!
    self.world = world
    # ...
```

### 3. Class Constants –¥–ª—è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–∞–∫ class constants:**

```python
# –ì–µ–æ–º–µ—Ç—Ä–∏—è
WIDGET_X = 275
WIDGET_Y = 35
WIDTH = 700
HEIGHT = 420

# –®—Ä–∏—Ñ—Ç
FONT_SIZE = 16
FONT_PATH = './tests/Ac437_Siemens_PC-D.ttf'

# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∞–∑–º–µ—Ä—ã
PADDING_X = 10
PADDING_Y = 10
BORDER_WIDTH = 2

# –¶–≤–µ—Ç–∞ (–≤—Å–µ–≥–¥–∞ —Å–ª–æ–≤–∞—Ä—å)
COLORS = {
    'background': (30, 30, 30),
    'border': (150, 150, 150),
    'text': (200, 200, 200),
    'highlight': (0, 255, 100),
    'selected': (255, 255, 0),
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (–≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Ñ–∞–π–ª–∞)
- –ù–µ—Ç "–º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª" –≤ –∫–æ–¥–µ
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –≤—Å–µ–º–∏ –≤–∏–¥–∂–µ—Ç–∞–º–∏

### 4. pygame.Surface –¥–ª—è –û—Ç—Ä–∏—Å–æ–≤–∫–∏

–í—Å–µ –≤–∏–¥–∂–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `surface`:

```python
def __init__(self):
    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å
    self.surface = pygame.Surface((self.WIDTH, self.HEIGHT))
    
```

**–ü–æ—á–µ–º—É?**
- –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
- –õ–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
- –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞



### 6. –ú–µ—Ç–æ–¥ draw() - –ï–¥–∏–Ω—ã–π –ö–æ–Ω—Ç—Ä–∞–∫—Ç

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞:**

```python
# –î–ª—è –≤–∏–¥–∂–µ—Ç–æ–≤, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç RenderStateDTO (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
def draw(self, screen: pygame.Surface, render_state: RenderStateDTO) -> None:
    ...


# –î–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
def draw(self, screen: pygame.Surface, render_state: RenderStateDTO) -> None:
    # handle_keydown() –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏
    ...
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- –ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: `screen: pygame.Surface`
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏—Ä–∞
- –¢–æ–ª—å–∫–æ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `None`

### 7. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –°–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞ - –≤ —Ñ–∞–π–ª–µ –≤–∏–¥–∂–µ—Ç–∞ –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**

```python
# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û –≤ –≤–∏–¥–∂–µ—Ç–∞—Ö
from world import world
from service.logger.logger import logme
from service.debugger.debugger import debug
from simparams import sp
```

**–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ - –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ RenderStateDTO:**

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
def draw(self, screen: pygame.Surface, render_state: RenderStateDTO) -> None:
    # –î–∞–Ω–Ω—ã–µ —É–∂–µ –≤ render_state:
    population = len(render_state.world.creatures)
    tick = render_state.tick
    params = render_state.params.mutation_probability
    # ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ ...
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Renderer

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –ö–ª–∞—Å—Å –í–∏–¥–∂–µ—Ç–∞

```python
# renderer/v3dto/gui_mywidget.py
# -*- coding: utf-8 -*-
"""–û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –∏ –µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è."""

import pygame
from typing import Optional, TYPE_CHECKING

if TYPE_CHECKING:
    from .dto import RenderStateDTO

class MyWidget:
    """–û–ø–∏—Å–∞–Ω–∏–µ."""
    
    # –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
    WIDGET_X = 10
    WIDGET_Y = 10
    WIDTH = 200
    HEIGHT = 100
    
    FONT_SIZE = 14
    FONT_PATH = './tests/Ac437_Siemens_PC-D.ttf'
    
    COLORS = {
        'background': (30, 30, 30),
        'text': (200, 200, 200),
    }
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π."""
        self.rect = pygame.Rect(self.WIDGET_X, self.WIDGET_Y, 
                                self.WIDTH, self.HEIGHT)
        self.surface = pygame.Surface((self.WIDTH, self.HEIGHT), pygame.SRCALPHA)
        try:
            self.font = pygame.font.Font(self.FONT_PATH, self.FONT_SIZE)
        except:
            self.font = pygame.font.Font(None, self.FONT_SIZE)
    
    def draw(self, screen: pygame.Surface, render_state: 'RenderStateDTO') -> None:
        """–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–∏–¥–∂–µ—Ç–∞."""
        self.surface.fill(self.COLORS['background'])
        # ... –≤–∞—à –∫–æ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ ...
        screen.blit(self.surface, (self.rect.x, self.rect.y))
```

### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Renderer

```python
# renderer/v3dto/renderer.py
from renderer.v3dto.gui_mywidget import MyWidget

class Renderer:
    def __init__(self, world, app):
        # ...
        self.my_widget = MyWidget()  # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–ï–ó –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

### –®–∞–≥ 3: –í—ã–∑–≤–∞—Ç—å draw() –≤ –ù—É–∂–Ω–æ–º –°–æ—Å—Ç–æ—è–Ω–∏–∏

```python
def _draw_main(self, render_state: RenderStateDTO) -> None:
    """–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è."""
    # ... –¥—Ä—É–≥–∏–µ –≤–∏–¥–∂–µ—Ç—ã ...
    self.my_widget.draw(self.screen, render_state)  # –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ screen –∏ RenderStateDTO
    # ... –¥—Ä—É–≥–∏–µ –≤–∏–¥–∂–µ—Ç—ã ...
```

### –®–∞–≥ 4 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –û–±—Ä–∞–±–æ—Ç–∫–∞ –°–æ–±—ã—Ç–∏–π

–ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π (–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞, –º—ã—à—å):

```python
class MyWidget:
    # ... existing code ...
    
    def handle_keydown(self, event: pygame.event.Event) -> bool:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
        
        Returns:
            True –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, False –µ—Å–ª–∏ –Ω–µ—Ç
        """
        if event.key == pygame.K_RETURN:
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è
            return True
        return False
    
    def handle_mousebuttondown(self, event: pygame.event.Event) -> bool:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –º—ã—à–∫–∏."""
        if self.rect.collidepoint(event.pos):
            # –í–∏–¥–∂–µ—Ç –±—ã–ª –∫–ª–∏–∫–Ω—É—Ç
            return True
        return False
```

–ò –≤ Renderer:

```python
def _handle_keyboard_main(self, event: pygame.event.Event) -> bool:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏."""
    if self.my_widget.handle_keydown(event):
        return True
    # ... –¥—Ä—É–≥–∏–µ –≤–∏–¥–∂–µ—Ç—ã ...
    return False
```

---

## üìê –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –í–∏–¥–∂–µ—Ç–æ–≤ –Ω–∞ –≠–∫—Ä–∞–Ω–µ

### –ú–∞–∫–µ—Ç v3dto

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1250 px (SCREEN_WIDTH)                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                      ‚îÇ  VariablesPanel             ‚îÇ
‚îÇ  Viewport (1240x500) ‚îÇ  (700x420, editable)        ‚îÇ
‚îÇ  (5, 5)              ‚îÇ  (275, 35)                  ‚îÇ
‚îÇ                      ‚îÇ                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  SelectedCreaturePanel (250x300, left)              ‚îÇ
‚îÇ  (35, 150)                                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  SelectedCreatureHistory / PopulationChart (1243x65) ‚îÇ
‚îÇ  (4, 505)                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∞–≤–∏–ª–∞ –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ constants –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:**
   ```python
   WIDGET_X = 5
   WIDGET_Y = 5
   WIDTH = 1240
   HEIGHT = 500
   ```


3. **–û—Å—Ç–∞–≤–ª—è–π—Ç–µ –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –≤–∏–¥–∂–µ—Ç–∞–º–∏:**
   - –ú–∏–Ω–∏–º—É–º 5 –ø–∏–∫—Å–µ–ª–µ–π –æ—Ç –∫—Ä–∞—è
   - –ú–∏–Ω–∏–º—É–º 5 –ø–∏–∫—Å–µ–ª–µ–π –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ –≤–∏–¥–∂–µ—Ç–∞–º–∏


---

## üé® –¶–≤–µ—Ç–æ–≤–∞—è –°—Ö–µ–º–∞

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ü–∞–ª–∏—Ç—Ä–∞

```python
COLORS = {
    'background': (30, 30, 30),      # –¢–µ–º–Ω—ã–π —Ñ–æ–Ω
    'border': (150, 150, 150),       # –°–µ—Ä–æ–≤–∞—Ç–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
    'text': (200, 200, 200),         # –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç
    'label': (100, 150, 200),        # –ì–æ–ª—É–±–æ–π –¥–ª—è –º–µ—Ç–æ–∫
    'highlight': (0, 255, 100),      # –Ø—Ä–∫–∏–π –∑–µ–ª—ë–Ω—ã–π –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
    'selected': (255, 255, 0),       # –ñ—ë–ª—Ç—ã–π –¥–ª—è –≤—ã–±–æ—Ä–∞
}
```

### –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–∂–µ—Ç—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BIOS —Å—Ç–∏–ª—å –≤ —Ü–≤–µ—Ç–∞—Ö:

**VariablesPanel (BIOS —Å—Ç–∏–ª—å):**
```python
COLORS = {
    'bg': (5, 41, 158),              # –°–∏–Ω–∏–π —Ñ–æ–Ω
    'text': (170, 170, 170),         # –°–µ—Ä—ã–π —Ç–µ–∫—Å—Ç
    'highlight': (255, 255, 255),    # –ë–µ–ª—ã–π –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
    'selected': (0, 167, 225),       # –ì–æ–ª—É–±–æ–π –¥–ª—è –≤—ã–±–æ—Ä–∞
}
```

**Viewport (–∫–∞—Ä—Ç–∞ –º–∏—Ä–∞):**
```python
COLORS = {
    'bg': (10, 10, 10),              # –ü–æ—á—Ç–∏ —á—ë—Ä–Ω—ã–π
    'wall': (50, 50, 50),            # –°—Ç–µ–Ω—ã - —Ç—ë–º–Ω–æ-—Å–µ—Ä—ã–µ
    'food': (219, 80, 74),           # –ï–¥–∞ - –∫—Ä–∞—Å–Ω–∞—è
    'creature': (50, 50, 255),       # –°—É—â–µ—Å—Ç–≤–∞ - —Å–∏–Ω–∏–µ
    'text': (200, 200, 200),         # –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç
}
```

### –ü—Ä–∞–≤–∏–ª–∞

- **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ pure black/white:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–º—è–≥—á—ë–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
- **–ö–æ–Ω—Ç—Ä–∞—Å—Ç:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞ —Ñ–æ–Ω–µ
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –í–∏–¥–∂–µ—Ç–∞

–ö–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø–æ–ª–Ω—ã–π docstring –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞:

```python
# -*- coding: utf-8 -*-
"""
MyWidget - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ.

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:
- –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∏–¥–∂–µ—Ç
- –ö–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–ø–æ–ª–Ω—è–µ—Ç
- –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –Ω–∞ —ç–∫—Ä–∞–Ω–µ

–ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ, –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è.

–ê–†–•–ò–¢–ï–ö–¢–£–†–ê v3dto:
- –ù–ï –∏–º–µ–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç world, logger, debugger
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ RenderStateDTO
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç singleton'–æ–≤
"""
```

–ò docstring –∫–ª–∞—Å—Å–∞:

```python
class MyWidget:
    """
    –û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –∏ –µ–≥–æ —Ä–æ–ª–∏.
    
    –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ [–º–µ—Å—Ç–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ] —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏.
    
    –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ DTO:
    - –ü–æ–ª—É—á–∞–µ—Ç RenderStateDTO –≤ –º–µ—Ç–æ–¥–µ draw()
    - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ render_state.[–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è]
    - –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç —Å–∏–Ω–≥–ª—å—Ç–æ–Ω–æ–≤
    """
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ù–æ–≤–æ–≥–æ –í–∏–¥–∂–µ—Ç–∞

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ä–æ–ª—å –≤–∏–¥–∂–µ—Ç–∞ (—á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç)
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
- [ ] –û–ø—Ä–µ–¥–µ–ª—ë–Ω —Ä–∞–∑–º–µ—Ä (WIDTH, HEIGHT)

### –í –∫–æ–¥–µ:
- [ ] –§–∞–π–ª —Å–æ–∑–¥–∞–Ω –≤ `renderer/v3dto/gui_*.py`
- [ ] Docstring –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ (–æ–ø–∏—Å–∞–Ω–∏–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [ ] Class constants –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (POSITION, SIZE, COLORS, FONT)
- [ ] `__init__()` –ë–ï–ó –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—Ç–æ–ª—å–∫–æ self)
- [ ] –°–æ–∑–¥–∞–Ω `pygame.Rect` –¥–ª—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏
- [ ] –°–æ–∑–¥–∞–Ω–∞ `pygame.Surface` –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
- [ ] –ú–µ—Ç–æ–¥ `draw(screen, render_state)` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ù–∏–∫–∞–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ —Å–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤ (world, logger, debugger, simparams)
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ `RenderStateDTO`

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ `renderer.py`
- [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ `Renderer.__init__()` –ë–ï–ó –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- [ ] –í—ã–∑–≤–∞–Ω –≤ –Ω—É–∂–Ω–æ–º `_draw_*()` –º–µ—Ç–æ–¥–µ
- [ ] –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π - –¥–æ–±–∞–≤–ª–µ–Ω—ã `handle_*()` –º–µ—Ç–æ–¥—ã
- [ ] –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–∑–≤–∞–Ω—ã –≤ `_handle_keyboard/mouse()`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –í–∏–¥–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
- [ ] –î–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–æ–±—ã—Ç–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ RenderStateDTO

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –°—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –í–∏–¥–∂–µ—Ç–æ–≤

### Viewport (–ü—Ä–æ—Å—Ç–æ–π –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π)
- **–§–∞–π–ª:** `gui_viewport.py`
- **–†–æ–ª—å:** –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã –º–∏—Ä–∞
- **–†–∞–∑–º–µ—Ä:** 1240x500
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:** 
  - –ò–º–µ–µ—Ç `handle_mouse_drag()` –∏ `handle_mouse_wheel()`
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–º–µ—Ä—ã (offset, scale)

### SelectedCreaturePanel (–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ü–∞–Ω–µ–ª—å)
- **–§–∞–π–ª:** `gui_selected_creature.py`
- **–†–æ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å—É—â–µ—Å—Ç–≤–µ
- **–†–∞–∑–º–µ—Ä:** 250x300
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è (—Ç–æ–ª—å–∫–æ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞)
- **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç:** render_state.selected_creature

### VariablesPanel (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è)
- **–§–∞–π–ª:** `gui_variablespanel.py`
- **–†–æ–ª—å:** –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏
- **–†–∞–∑–º–µ—Ä:** 700x420
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç callback `on_parameter_change` –≤ `__init__`
  - –ú–æ–¥–∞–ª—å–Ω–æ–µ (pause simulation –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏)
  - –ò–º–µ–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (selected_index, editing, input_buffer)
  - `handle_keydown()` –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RenderStateDTO** (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ!)

### CreaturesListModal (–ú–æ–¥–∞–ª—å–Ω–æ–µ –û–∫–Ω–æ)
- **–§–∞–π–ª:** `gui_creatures_list.py`
- **–†–æ–ª—å:** –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏
- **–†–∞–∑–º–µ—Ä:** 600x450 (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - –ú–æ–¥–∞–ª—å–Ω–æ–µ (pause simulation –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏)
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (selected_index, scroll_offset)
  - `handle_keydown()` –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  - **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RenderStateDTO** –≤ draw() (–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –≤ –±—É–¥—É—â–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RenderStateDTO)

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –û—à–∏–±–∫–∏

### 1. –ò–º–ø–æ—Ä—Ç —Å–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤

‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
from service.logger.logger import logme
from world import world

class MyWidget:
    def draw(self, screen, render_state):
        population = len(world.creatures)  # ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å!
```

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
class MyWidget:
    def draw(self, screen, render_state):
        population = len(render_state.world.creatures)  # ‚úÖ –ß–µ—Ä–µ–∑ DTO
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏—Ä–∞

‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
def draw(self, screen, render_state):
    self.world.creatures[0].energy = 100  # ‚ùå Side effect!
```

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
def draw(self, screen, render_state):
    # –¢–æ–ª—å–∫–æ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞, –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
    energy = render_state.world.creatures[0].energy
    # ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ ...
```

### 3. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞

‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
class MyWidget:
    def __init__(self):
        self.x = 10
        self.y = 20
        self.width = 200
        self.height = 150
```

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
class MyWidget:
    WIDGET_X = 10
    WIDGET_Y = 20
    WIDTH = 200
    HEIGHT = 150
    
    def __init__(self):
        self.rect = pygame.Rect(self.WIDGET_X, self.WIDGET_Y, 
                                self.WIDTH, self.HEIGHT)
```

### 5. –î–∏—Ä–µ–∫—Ç–Ω—ã–π –±–ª–∏—Ç –Ω–∞ screen

‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
def draw(self, screen, render_state):
    text = self.font.render("Hello", True, (255, 255, 255))
    screen.blit(text, (100, 100))  # –†–∏—Å—É–µ–º –ø—Ä—è–º–æ –Ω–∞ screen
```

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
def draw(self, screen, render_state):
    self.surface.fill(self.COLORS['background'])
    text = self.font.render("Hello", True, self.COLORS['text'])
    self.surface.blit(text, (self.PADDING, self.PADDING))
    screen.blit(self.surface, (self.rect.x, self.rect.y))
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç - –®–∞–±–ª–æ–Ω –í–∏–¥–∂–µ—Ç–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞:

```python
# -*- coding: utf-8 -*-
"""
MyNewWidget - –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞.

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç: [—á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç]

–ê–†–•–ò–¢–ï–ö–¢–£–†–ê v3dto:
- –ù–ï –∏–º–µ–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç world, logger, debugger
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ RenderStateDTO
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç singleton'–æ–≤
"""

import pygame
from typing import Optional, TYPE_CHECKING

if TYPE_CHECKING:
    from .dto import RenderStateDTO


class MyNewWidget:
    """–û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –∏ –µ–≥–æ —Ä–æ–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ."""
    
    # ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
    WIDGET_X = 10
    WIDGET_Y = 10
    WIDTH = 200
    HEIGHT = 100
    
    FONT_SIZE = 14
    FONT_PATH = './tests/Ac437_Siemens_PC-D.ttf'
    
    COLORS = {
        'background': (30, 30, 30),
        'border': (150, 150, 150),
        'text': (200, 200, 200),
        'highlight': (0, 255, 100),
    }
    
    BORDER_WIDTH = 2
    PADDING = 10
    LINE_HEIGHT = 20
    
    # ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π."""
        # –ì–µ–æ–º–µ—Ç—Ä–∏—è
        self.rect = pygame.Rect(self.WIDGET_X, self.WIDGET_Y, 
                                self.WIDTH, self.HEIGHT)
        
        # –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å
        self.surface = pygame.Surface((self.WIDTH, self.HEIGHT), pygame.SRCALPHA)
        
        # –®—Ä–∏—Ñ—Ç
        try:
            self.font = pygame.font.Font(self.FONT_PATH, self.FONT_SIZE)
        except (FileNotFoundError, pygame.error):
            self.font = pygame.font.Font(None, self.FONT_SIZE)
    
    # ========== –û–¢–†–ò–°–û–í–ö–ê ==========
    def draw(self, screen: pygame.Surface, render_state: 'RenderStateDTO') -> None:
        """
        –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–∏–¥–∂–µ—Ç–∞.
        
        Args:
            screen: Pygame surface –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            render_state: RenderStateDTO —Å –¥–∞–Ω–Ω—ã–º–∏
        """
        # –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å
        self.surface.fill(self.COLORS['background'])
        
        # –ì—Ä–∞–Ω–∏—Ü–∞
        pygame.draw.rect(self.surface, self.COLORS['border'], 
                        self.surface.get_rect(), self.BORDER_WIDTH)
        
        # –í–∞—à –∫–æ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∑–¥–µ—Å—å
        # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ render_state –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        # ...
        
        # –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        screen.blit(self.surface, (self.rect.x, self.rect.y))
```

**–ó–∞—Ç–µ–º –¥–æ–±–∞–≤–∏—Ç—å –≤ Renderer:**

```python
# renderer/v3dto/renderer.py
from renderer.v3dto.gui_mynewwidget import MyNewWidget

class Renderer:
    def __init__(self, world, app):
        # ...
        self.my_new_widget = MyNewWidget()
    
    def _draw_main(self, render_state: RenderStateDTO) -> None:
        # ...
        self.my_new_widget.draw(self.screen, render_state)
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –†–µ—Å—É—Ä—Å—ã

  - `gui_viewport.py` ‚Äî –ü—Ä–∏–º–µ—Ä —Å–ª–æ–∂–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
  - `gui_selected_creature.py` ‚Äî –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
  - `gui_variablespanel.py` ‚Äî –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ —Å callback
  - `gui_creatures_list.py` ‚Äî –ü—Ä–∏–º–µ—Ä –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  - `gui_pop_chart.py` ‚Äî –ü—Ä–∏–º–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ Pygame surface

---

## üìû –°–≤–æ–¥–∫–∞

| –í–æ–ø—Ä–æ—Å | –û—Ç–≤–µ—Ç |
|--------|-------|
| **–ì–¥–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã?** | `renderer/v3dto/gui_*.py` |
| **–ß—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å?** | –¢–æ–ª—å–∫–æ `pygame`, DTO –∫–ª–∞—Å—Å—ã, NO —Å–∏–Ω–≥–ª—Ç–æ–Ω—ã |
| **–ß—Ç–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ __init__?** | –ù–∏—á–µ–≥–æ –∏–ª–∏ —Ç–æ–ª—å–∫–æ callback (Callable) |
| **–ö–∞–∫ –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ?** | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ RenderStateDTO –≤ draw() |
| **–ö–∞–∫ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å?** | –ù–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π surface, –ø–æ—Ç–æ–º bl–∏—Ç –Ω–∞ screen |
| **–ì–¥–µ –º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã?** | Class constants –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –∫–ª–∞—Å—Å–∞ |
| **–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è?** | handle_keydown(), handle_mousebuttondown() –∏ —Ç.–¥. |
| **–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–Ω–¥–µ—Ä?** | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ Renderer.__init__(), –≤—ã–∑–≤–∞—Ç—å –≤ _draw_*() |

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2026-01-18  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** v3dto (DTO-based isolation)
