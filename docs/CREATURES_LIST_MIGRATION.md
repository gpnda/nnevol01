# CreaturesListModal - v3dto –ú–∏–≥—Ä–∞—Ü–∏—è

## –û–±–∑–æ—Ä

`CreaturesListModal` - —ç—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞—Ä–æ–≥–æ `gui_creatures_popup.py` –∏–∑ –≤–µ—Ä—Å–∏–∏ 1 —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É v3dto.

–í–∏–¥–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Å—Ç–∏–ª–µ BIOS/Norton Commander.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### ‚úÖ –ß–¢–û –û–°–¢–ê–õ–û–°–¨ (–∏–∑ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏)

1. **–í–Ω–µ—à–Ω–∏–π –≤–∏–¥**
   - –°—Ç–∏–ª—å BIOS/Norton Commander (—Å–∏–Ω–∏–π —Ñ–æ–Ω, —Å–µ—Ä—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã)
   - –¢–∞–±–ª–∏—Ü–∞ —Å —Å—Ç–æ–ª–±—Ü–∞–º–∏: ID, Age, X, Y, Energy, Speed
   - –í—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
   - –ü–æ–¥—Å–∫–∞–∑–∫–∏ –≤–Ω–∏–∑—É –æ–∫–Ω–∞

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**
   - –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑
   - Home/End –¥–ª—è –ø—Ä—ã–∂–∫–∞ –≤ –Ω–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü
   - ESC –∏–ª–∏ F1 –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞

3. **–ì–µ–æ–º–µ—Ç—Ä–∏—è**
   - –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
   - –†–∞–∑–º–µ—Ä—ã: 600√ó450 –ø–∏–∫—Å–µ–ª–µ–π
   - –ú–∞–∫—Å–∏–º—É–º 18 –≤–∏–¥–∏–º—ã—Ö —Å—Ç—Ä–æ–∫ —Å –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª–æ–º

### ‚úÖ –ß–¢–û –ò–ó–ú–ï–ù–ò–õ–û–°–¨ (–∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ v3dto)

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ DTO**
   - **–î–û**: –í–∏–¥–∂–µ—Ç –ø–æ–ª—É—á–∞–ª –æ–±—ä–µ–∫—Ç `world` –∏ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ `world.creatures`
   - **–ü–û–°–õ–ï**: –í–∏–¥–∂–µ—Ç –ø–æ–ª—É—á–∞–µ—Ç `RenderStateDTO` –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `render_state.world.creatures`

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Renderer**
   - **–î–û**: –í–∏–¥–∂–µ—Ç –≤—ã–∑—ã–≤–∞–ª—Å—è –Ω–∞–ø—Ä—è–º—É—é —Å `world` –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
   - **–ü–û–°–õ–ï**: 
     - –í–∏–¥–∂–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
     - Renderer —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –Ω–∞–≤–∏–≥–∞—Ü–∏—è)
     - Renderer –ø–µ—Ä–µ–¥–∞—ë—Ç `RenderStateDTO` –≤ –º–µ—Ç–æ–¥–µ `draw()`

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π**
   - **–î–û**: –í–∏–¥–∂–µ—Ç —Å–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
   - **–ü–û–°–õ–ï**: 
     - Renderer –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ `_handle_keyboard_creatures_list()`
     - Vi–¥–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã: `move_selection_up()`, `move_selection_down()`, etc.
     - Renderer –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –ø–µ—Ä–µ–¥–∞–≤ `creatures_count`

4. **–°–æ—Å—Ç–æ—è–Ω–∏–µ**
   - **–î–û**: –í–∏–¥–∂–µ—Ç –∏–º–µ–ª –ø–æ–ª–µ `visible`
   - **–ü–û–°–õ–ï**: –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Renderer (state machine)
   - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `reset()` –¥–ª—è —Å–±—Ä–æ—Å–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∞

5. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   - **–î–û**: –ó–∞–≤–∏—Å–µ–ª –æ—Ç `world` –∏ `pygame`
   - **–ü–û–°–õ–ï**: –ó–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç `pygame` –∏ `RenderStateDTO` (–≤ TYPE_CHECKING)

### üÜï –ù–û–í–´–ï –ú–ï–¢–û–î–´

```python
# –ù–∞–≤–∏–≥–∞—Ü–∏—è (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ Renderer)
def move_selection_up(creatures_count: int) -> None
def move_selection_down(creatures_count: int) -> None
def move_selection_home() -> None
def move_selection_end(creatures_count: int) -> None
def reset() -> None

# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
def get_selected_creature_id(creatures_count: int) -> int

# –û—Ç—Ä–∏—Å–æ–≤–∫–∞ (v3dto –ø–∞—Ç—Ç–µ—Ä–Ω)
def draw(screen: pygame.Surface, render_state: RenderStateDTO) -> None
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ Renderer

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
# –í Renderer.__init__():
from renderer.v3dto.gui_creatures_list import CreaturesListModal

self.creatures_list_modal = CreaturesListModal()
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

```python
# –í Renderer._on_state_enter():
if state_name == 'creatures_list':
    self.creatures_list_modal.reset()
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

```python
# –í Renderer._handle_keyboard_creatures_list():
def _handle_keyboard_creatures_list(self, event: pygame.event.Event) -> bool:
    if event.type != pygame.KEYDOWN:
        return False
    
    if event.key == pygame.K_ESCAPE or event.key == pygame.K_F1:
        self.set_state('main')
        return True
    
    creatures_count = len(self.world.creatures)
    
    if event.key == pygame.K_UP:
        self.creatures_list_modal.move_selection_up(creatures_count)
        return True
    
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏
```

### 4. –û—Ç—Ä–∏—Å–æ–≤–∫–∞

```python
# –í Renderer._draw_creatures_list():
def _draw_creatures_list(self, render_state: RenderStateDTO) -> None:
    self.creatures_list_modal.draw(self.screen, render_state)
```

## v3dto –ü–∞—Ç—Ç–µ—Ä–Ω—ã, –∫–æ—Ç–æ—Ä—ã–º —Å–ª–µ–¥—É–µ—Ç –≤–∏–¥–∂–µ—Ç

‚úÖ **Constants Configuration**
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—é—Ç—Å—è –∫–∞–∫ class constants
- –ù–∏–∫–∞–∫–∏—Ö magic numbers –≤ –∫–æ–¥–µ

‚úÖ **Zero-Dependency Init**
- `__init__()` –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–∫—Ä–æ–º–µ self)
- –ù–∏–∫–∞–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞–º (world, logger, debugger, simparams)
- –¢–æ–ª—å–∫–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π

‚úÖ **draw() Method**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `screen: pygame.Surface` –∏ `render_state: RenderStateDTO`
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ `render_state`
- –ù–∏–∫–∞–∫–∏—Ö –ø—Ä—è–º—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞–º

‚úÖ **DTO Isolation**
- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –æ—Ç —Å–∏–Ω–≥–ª—å—Ç–æ–Ω–æ–≤
- 100% –Ω–µ–∑–∞–≤–∏—Å–∏–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å mock `RenderStateDTO` –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ä–∏—Å–æ–≤–∫—É

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞

```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç F1
# Renderer –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
renderer.set_state('creatures_list')
# ‚Üí _on_state_enter() –≤—ã–∑—ã–≤–∞–µ—Ç reset()
```

### –ù–∞–≤–∏–≥–∞—Ü–∏—è

```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç UP
renderer._handle_keyboard_creatures_list(event)
# ‚Üí renderer.creatures_list_modal.move_selection_up(creatures_count)
```

### –û—Ç—Ä–∏—Å–æ–≤–∫–∞

```python
# –í –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
render_state = renderer._prepare_render_state_dto()
renderer.creatures_list_modal.draw(renderer.screen, render_state)
```

### –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞

```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ESC
renderer.set_state('main')
# ‚Üí –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è, –æ–∫–Ω–æ –±–æ–ª—å—à–µ –Ω–µ —Ä–∏—Å—É–µ—Ç—Å—è
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: v1 vs v3dto

| –ê—Å–ø–µ–∫—Ç | v1 (gui_creatures_popup.py) | v3dto (gui_creatures_list.py) |
|--------|-----|-----|
| **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** | `__init__(world)` | `__init__()` |
| **–í–∏–¥–∏–º–æ—Å—Ç—å** | `self.visible` —Ñ–ª–∞–≥ | State machine –≤ Renderer |
| **–°–æ–±—ã—Ç–∏—è** | `handle_event()` —Å–∞–º –≤—Å—ë –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç | –û—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ |
| **–î–∞–Ω–Ω—ã–µ** | –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ `world.creatures` | –ß–µ—Ä–µ–∑ `render_state.world.creatures` |
| **–°–∏–Ω–≥–ª—Ç–æ–Ω—ã** | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `world` | –ù–µ –∑–∞–≤–∏—Å–∏—Ç –≤–æ–æ–±—â–µ |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | –°–ª–æ–∂–Ω–æ–µ (–Ω—É–∂–µ–Ω mock world) | –ü—Ä–æ—Å—Ç–æ–µ (mock RenderStateDTO) |
| **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** | –°–ª–æ–∂–Ω–æ–µ (—Å–≤—è–∑–∞–Ω–æ —Å world) | –ü—Ä–æ—Å—Ç–æ–µ (—Ç–æ–ª—å–∫–æ DTO) |

## –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–í—ã–±–æ—Ä —Å—É—â–µ—Å—Ç–≤–∞**
   - –î–æ–±–∞–≤–∏—Ç—å Enter –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—É—â–µ—Å—Ç–≤–∞
   - –í—ã–±—Ä–∞–Ω–Ω–æ–µ —Å—É—â–µ—Å—Ç–≤–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `selected_creature_id` –≤ Renderer

2. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**
   - –î–æ–±–∞–≤–∏—Ç—å S –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–ø–æ ID, —ç–Ω–µ—Ä–≥–∏–∏, –≤–æ–∑—Ä–∞—Å—Ç—É –∏ —Ç.–¥.)
   - –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (ASC/DESC)

3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**
   - –î–æ–±–∞–≤–∏—Ç—å F –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ —ç–Ω–µ—Ä–≥–∏–∏ > X)
   - –ü–æ–∏—Å–∫ –ø–æ ID (Ctrl+F)

4. **–î–µ—Ç–∞–ª–∏ —Å—É—â–µ—Å—Ç–≤–∞**
   - –ù–∞–∂–∞—Ç—å D –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—É—â–µ—Å—Ç–≤–µ
   - –ü–æ–∫–∞–∑–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º popup NN —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

5. **–≠–∫—Å–ø–æ—Ä—Ç**
   - –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –≤ CSV
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ü–∏–∏

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- [x] –í–∏–¥–∂–µ—Ç —Å–æ–∑–¥–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ v3dto –ø–∞—Ç—Ç–µ—Ä–Ω—É
- [x] –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç —Å–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤
- [x] –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ RenderStateDTO
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ Renderer
- [x] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [x] –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ
- [] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ runtime
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
- [ ] –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∑–∞–Ω–æ—Å—è—Ç—Å—è –≤ backlog

## –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚úÖ

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –∏–∑ v1 –≤ v3dto –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –ø–æ–ª–Ω–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π –∫ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º DTO –∏–∑–æ–ª—è—Ü–∏–∏.
