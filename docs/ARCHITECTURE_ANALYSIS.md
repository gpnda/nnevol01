# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ Renderer: –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –ü—Ä–æ–±–ª–µ–º—ã —Å —É—Ç–µ—á–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. **–î–∏–∞–≥–Ω–æ–∑ –ø—Ä–æ–±–ª–µ–º—ã**

Renderer –∏ –µ–≥–æ –≤–∏–¥–∂–µ—Ç—ã —Å—Ç—Ä–∞–¥–∞—é—Ç –æ—Ç **—Ç–µ—Å–Ω–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏** —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Renderer & Widgets (Presentation Layer)                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚úó –ü–æ–ª—É—á–∞–µ—Ç world –Ω–∞–ø—Ä—è–º—É—é                               ‚îÇ
‚îÇ ‚úó –û–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ world.creatures[] –ø—Ä—è–º–æ                 ‚îÇ
‚îÇ ‚úó –ß–∏—Ç–∞–µ—Ç –∏–∑ singleton debug –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∏–¥–∂–µ—Ç–∞—Ö       ‚îÇ
‚îÇ ‚úó –ß–∏—Ç–∞–µ—Ç –∏–∑ singleton logme –≤ SelectedCreatureHistory   ‚îÇ
‚îÇ ‚úó –ú–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –≤ world.map –Ω–∞–ø—Ä—è–º—É—é                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì                    ‚Üì                    ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ world  ‚îÇ          ‚îÇ debug   ‚îÇ         ‚îÇ logme    ‚îÇ
    ‚îÇ (data) ‚îÇ          ‚îÇ(global) ‚îÇ         ‚îÇ(global)  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç world
- –¢—Ä—É–¥–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (e.g., —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∏–≥—Ä—É)
- –°–∏–Ω–≥–ª—Ç–æ–Ω—ã —Å–æ–∑–¥–∞—é—Ç —Å–∫—Ä—ã—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã world –ª–æ–º–∞–µ—Ç renderer

---

## 2. **–¢–æ—á–∫–∏ —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–¥–µ**

### üìç **Viewport** (`gui_viewport.py:8`)
```python
from service.debugger.debugger import debug

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
debug.set("raycast_dots", raycast_dots)  # –ü–∏—à–µ—Ç –≤ —Å–∏–Ω–≥–ª—Ç–æ–Ω
```
**–ü—Ä–æ–±–ª–µ–º–∞:** Viewport –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

### üìç **VariablesPanel** (`gui_variablespanel.py:44-45`)
```python
def __init__(self, world):
    self.world = world  # –ñ—ë—Å—Ç–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ world
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ world –¥–ª—è —á—Ç–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

### üìç **SelectedCreaturePanel** (`gui_selected_creature.py:44-45`)
```python
def __init__(self, world):
    self.world = world  # –ü–æ–ª—É—á–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ –ø–æ ID —á–µ—Ä–µ–∑ world
    
def draw(self, screen, selected_creature_id):
    selected_creature = self.world.get_creature_by_id(selected_creature_id)
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç world –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤–∞

---

### üìç **SelectedCreatureHistory** (`gui_selected_creature_history.py:15, 69`)
```python
from service.logger.logger import logme

def draw(self, screen, selected_creature_id):
    selected_creature = self.world.get_creature_by_id(selected_creature_id)  # world
    # ... –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç logme –Ω–∞–ø—Ä—è–º—É—é
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É logme —Å–∏–Ω–≥–ª—Ç–æ–Ω—É

---

### üìç **Renderer** (`renderer.py:21`)
```python
from service.logger.logger import logme

# –ü–æ–ª—É—á–∞–µ—Ç world –≤ __init__
self.world = world
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç world –∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –µ–≥–æ –≤–∏–¥–∂–µ—Ç–∞–º

---

## 3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ü–∞—Ç—Ç–µ—Ä–Ω Data Contracts**

### üéØ –ò–¥–µ—è: –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å Presentation –æ—Ç Domain

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã Renderer –ø–æ–ª—É—á–∞–ª `world` –∏ —Å–∏–Ω–≥–ª—Ç–æ–Ω—ã, –æ–Ω –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å **–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö** (Data Transfer Objects / DTO):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Application Layer                    ‚îÇ
‚îÇ (–∑–Ω–∞–µ—Ç –æ world, debugger, logger)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Data Contracts     ‚îÇ  ‚Üê –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    ‚îÇ (DTO/View Models)  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Renderer & Widgets                   ‚îÇ
‚îÇ (—Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å contracts)        ‚îÇ
‚îÇ (–Ω–µ –∑–Ω–∞—é—Ç –æ world/debug/logger)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω**

### **–≠—Ç–∞–ø 1: –°–æ–∑–¥–∞—Ç—å Data Contracts (dto.py)**

```python
# renderer/v2/dto.py
from dataclasses import dataclass
from typing import List, Optional, Dict, Any

@dataclass
class CreatureDTO:
    """–î–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
    id: int
    x: float
    y: float
    angle: float
    energy: float
    age: int
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

@dataclass
class WorldStateDTO:
    """–°–Ω–∏–º–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏—Ä–∞ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞"""
    map: Any  # numpy array
    width: int
    height: int
    creatures: List[CreatureDTO]
    foods: List[tuple]  # (x, y)
    tick: int

@dataclass
class CreatureHistoryDTO:
    """–ò—Å—Ç–æ—Ä–∏—è –∏ —Å–æ–±—ã—Ç–∏—è —Å—É—â–µ—Å—Ç–≤–∞"""
    creature_id: int
    energy_history: List[float]
    events: List[Dict[str, Any]]  # [{tick, type, value}, ...]
    
@dataclass
class DebugDataDTO:
    """Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"""
    raycast_dots: Any  # numpy array
    all_visions: Any   # numpy array
    all_outs: Any      # numpy array
    # ... –∏ —Ç.–¥.
```

---

### **–≠—Ç–∞–ø 2: –°–æ–∑–¥–∞—Ç—å View Models –≤ Renderer**

Renderer –ø–æ–ª—É—á–∞–µ—Ç world, –Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –µ–≥–æ –≤ DTO:

```python
# renderer/v2/renderer.py

class Renderer:
    def __init__(self, world, app):
        self.world = world  # –•—Ä–∞–Ω–∏–º, –Ω–æ –ù–ï –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç–∞–º
        self.app = app
        
        # –í–∏–¥–∂–µ—Ç—ã –ø–æ–ª—É—á–∞—é—Ç None –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        self.viewport = Viewport()
        self.variables_panel = VariablesPanel()
        self.selected_creature_panel = SelectedCreaturePanel()
        
    def draw(self):
        """–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç data –≤ contracts"""
        
        # 1. –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ world –≤ DTO
        world_dto = self._prepare_world_dto()
        debug_dto = self._prepare_debug_dto()
        history_dto = self._prepare_history_dto(self.selected_creature_id) if self.selected_creature_id else None
        
        # 2. –ü–µ—Ä–µ–¥–∞—Ç—å DTO –≤–∏–¥–∂–µ—Ç–∞–º (–æ–Ω–∏ –Ω–µ –∑–Ω–∞—é—Ç –æ world)
        self.viewport.draw(screen, world_dto)
        self.variables_panel.draw(screen, world_dto)
        if history_dto:
            self.selected_creature_panel.draw(screen, self.selected_creature_id, world_dto)
            self.selected_creature_history.draw(screen, history_dto)
    
    # DTO factories
    def _prepare_world_dto(self) -> WorldStateDTO:
        """–°–æ–±—Ä–∞—Ç—å —Å–Ω–∏–º–æ–∫ world –≤ DTO"""
        creatures_dto = [
            CreatureDTO(
                id=c.id, x=c.x, y=c.y, angle=c.angle,
                energy=c.energy, age=c.age, ...
            )
            for c in self.world.creatures
        ]
        return WorldStateDTO(
            map=self.world.map,
            width=self.world.width,
            height=self.world.height,
            creatures=creatures_dto,
            foods=[(f.x, f.y) for f in self.world.foods],
            tick=self.world.tick
        )
    
    def _prepare_debug_dto(self) -> DebugDataDTO:
        """–°–æ–±—Ä–∞—Ç—å debug data –∏–∑ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞ –≤ DTO"""
        return DebugDataDTO(
            raycast_dots=debug.get("raycast_dots"),
            all_visions=debug.get("all_visions"),
            all_outs=debug.get("all_outs")
        )
    
    def _prepare_history_dto(self, creature_id: int) -> CreatureHistoryDTO:
        """–°–æ–±—Ä–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑ logger –≤ DTO"""
        return CreatureHistoryDTO(
            creature_id=creature_id,
            energy_history=logme.get_creature_energy_history(creature_id),
            events=logme.get_creature_events(creature_id)
        )
```

---

### **–≠—Ç–∞–ø 3: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –ø—Ä–∏–Ω–∏–º–∞–ª–∏ DTO**

**Viewport:**
```python
# renderer/v2/gui_viewport.py
class Viewport:
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ world!"""
        self.camera_offset = ...
        self.camera_scale = ...
    
    def draw(self, screen: pygame.Surface, world_dto: WorldStateDTO, debug_dto: Optional[DebugDataDTO] = None):
        """–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ DTO"""
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º world_dto.map, world_dto.creatures –≤–º–µ—Å—Ç–æ self.world
        map_data = world_dto.map
        creatures = world_dto.creatures
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å debug –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if debug_dto and debug_dto.raycast_dots is not None:
            self._draw_debug_raycasts(debug_dto.raycast_dots)
```

**VariablesPanel:**
```python
# renderer/v2/gui_variablespanel.py
class VariablesPanel:
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ world!"""
        self.variables = {...}
    
    def draw(self, screen: pygame.Surface, world_dto: WorldStateDTO):
        """–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ DTO"""
        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        # –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º callback
        pass
    
    def on_variable_changed(self, name: str, value: Any) -> Callable:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç callback, –∫–æ—Ç–æ—Ä—ã–π Application'—è –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å"""
        return lambda: self._on_change_callback(name, value)
```

**SelectedCreaturePanel:**
```python
# renderer/v2/gui_selected_creature.py
class SelectedCreaturePanel:
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ world!"""
        pass
    
    def draw(self, screen: pygame.Surface, creature_id: int, world_dto: WorldStateDTO):
        """–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ DTO"""
        # –ù–∞—Ö–æ–¥–∏–º —Å—É—â–µ—Å—Ç–≤–æ –≤ DTO
        creature = next((c for c in world_dto.creatures if c.id == creature_id), None)
        if not creature:
            return
        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
```

**SelectedCreatureHistory:**
```python
# renderer/v2/gui_selected_creature_history.py
class SelectedCreatureHistory:
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ world –∏ logger!"""
        pass
    
    def draw(self, screen: pygame.Surface, history_dto: CreatureHistoryDTO):
        """–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ DTO"""
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º history_dto.energy_history –∏ history_dto.events
        # –ë–æ–ª—å—à–µ –Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç logme —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞!
```

---

## 5. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–°—Ä–∞–≤–Ω–µ–Ω–∏–µ)**

### ‚ùå **–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Tight Coupling)**
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** –ü—Ä–æ—Å—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±—ã—Å—Ç—Ä–æ
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:** 
  - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ
  - –°–∏–Ω–≥–ª—Ç–æ–Ω—ã —Å–æ–∑–¥–∞—é—Ç —Å–∫—Ä—ã—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  - –°–ª–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è (DTO/Data Contracts)**
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
  - –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è Presentation –æ—Ç Domain
  - –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (–ø–æ–¥—Å—É–Ω—É—Ç—å mock DTO)
  - –Ø–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  - –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:** –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å DTO –∫–ª–∞—Å—Å—ã (~100 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)

### üîÑ **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 1: Dependency Injection + Interfaces**
```python
class IWorldDataProvider:
    def get_creatures(self) -> List[CreatureDTO]: pass
    def get_map(self) -> np.ndarray: pass

# Renderer –∏–Ω—ä–µ–∫—Ç–∏—Ä—É–µ—Ç provider –≤ –≤–∏–¥–∂–µ—Ç—ã
viewport = Viewport(data_provider=world_provider)
```
- **–ü–ª—é—Å—ã:** –ì–∏–±—á–µ —á–µ–º DTO, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ
- **–ú–∏–Ω—É—Å—ã:** –ë–æ–ª–µ–µ –æ–±—ä—ë–º–Ω—ã–π –∫–æ–¥

### üìä **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 2: Event-Driven Architecture**
```python
# –í–º–µ—Å—Ç–æ "Renderer —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç world"
# "World –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç events, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª—É—à–∞–µ—Ç Renderer"

event_bus.subscribe("creature_moved", viewport.on_creature_moved)
event_bus.subscribe("food_spawned", viewport.on_food_spawned)
```
- **–ü–ª—é—Å—ã:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–≤—è–∑–∫–∞
- **–ú–∏–Ω—É—Å—ã:** –°–ª–æ–∂–Ω–µ–µ –æ—Ç–ª–∞–¥–∏—Ç—å, overhead –Ω–∞ —Å–æ–±—ã—Ç–∏—è

---

## 6. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

### ü•á **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: Viewport** (—Å–∞–º—ã–π –∫—Ä–∏—Ç–∏—á–Ω—ã–π)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `debug` —Å–∏–Ω–≥–ª—Ç–æ–Ω –¥–ª—è raycast_dots
- –ß–∞—Å—Ç–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ ‚Üí –±–æ–ª—å—à–æ–π overhead
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –£–±—Ä–∞—Ç—å `from service.debugger.debugger import debug`

```python
# –î–û:
class Viewport:
    def _draw_cells(self, ...):
        debug.set("raycast_dots", ...)

# –ü–û–°–õ–ï:
class Viewport:
    def _draw_cells(self, screen, world_dto: WorldStateDTO, debug_dto: DebugDataDTO = None):
        if debug_dto:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º debug_dto.raycast_dots
```

### ü•à **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: VariablesPanel**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç world –¥–ª—è —á—Ç–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ù—É–∂–Ω—ã callbacks –≤ Application

### ü•â **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: SelectedCreatureHistory**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç logger —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞
- –ú–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

---

## 7. **–ü—Ä–∏–º–µ—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞**

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (—Å DTO)
```python
# renderer.py
def draw(self):
    world_dto = self._prepare_world_dto()
    self.viewport.draw(screen, world_dto)
    
# viewport.py
def draw(self, screen, world_dto):
    for creature in world_dto.creatures:
        self._render_creature(creature)
```

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±)
```python
# renderer.py
self.viewport = Viewport(world=self.world)

# viewport.py
class Viewport:
    def __init__(self, world):
        self.world = world  # Tight coupling!
```

---

## 8. **–ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è**

### **–®–∞–≥ 1: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞** (–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫)
```
v2_new/
‚îú‚îÄ‚îÄ dto.py                    ‚Üê –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ renderer_new.py           ‚Üê –ù–æ–≤—ã–π renderer (—Å DTO)
‚îú‚îÄ‚îÄ gui_viewport_new.py       ‚Üê –ù–æ–≤—ã–π viewport (–±–µ–∑ world)
‚îî‚îÄ‚îÄ ...

v2/                           ‚Üê –°—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –µ—Å—Ç—å)
‚îú‚îÄ‚îÄ renderer.py
‚îú‚îÄ‚îÄ gui_viewport.py
‚îî‚îÄ‚îÄ ...
```

### **–®–∞–≥ 2: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DTO –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
2. –°–æ–∑–¥–∞—Ç—å factory –º–µ—Ç–æ–¥—ã –≤ Renderer –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
3. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º
4. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã

### **–®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
```python
# tests/test_viewport_with_dto.py
def test_viewport_renders_creatures():
    world_dto = WorldStateDTO(
        map=np.zeros((10, 10)),
        creatures=[CreatureDTO(id=1, x=5, y=5, ...)],
        # ...
    )
    viewport = Viewport()
    screen = pygame.Surface((100, 100))
    viewport.draw(screen, world_dto)  # –ù–µ –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π world!
```

---

## 9. **Checklist –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

- [ ] –°–æ–∑–¥–∞—Ç—å `renderer/v2/dto.py` —Å –∫–ª–∞—Å—Å–∞–º–∏ DTO
- [ ] –î–æ–±–∞–≤–∏—Ç—å factory –º–µ—Ç–æ–¥—ã –≤ `renderer.py` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è DTO
- [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `gui_viewport.py` —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å DTO
- [ ] –£–±—Ä–∞—Ç—å `from service.debugger.debugger import debug` –∏–∑ viewport
- [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `gui_variablespanel.py` —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å DTO
- [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `gui_selected_creature.py` —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å DTO
- [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `gui_selected_creature_history.py` —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å DTO + history_dto
- [ ] –£–±—Ä–∞—Ç—å `from service.logger.logger import logme` –∏–∑ widgets
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `widget.draw()` –≤ `renderer.py`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è –≤–∏–¥–∂–µ—Ç–æ–≤

---

## 10. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**

### üí° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

1. **State Management** - Renderer –∫–∞–∫ state manager
2. **Observer Pattern** - –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∏–∑ –≤–∏–¥–∂–µ—Ç–æ–≤
3. **Dependency Container** - –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## –í—ã–≤–æ–¥

**–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:** Renderer –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "–≥–ª—É–ø—ã–º" - —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (DTO), –∞ –Ω–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ world –∏ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞–º. Application (–∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª–æ–π Data Aggregation) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ world
2. –ß—Ç–µ–Ω–∏–µ –∏–∑ —Å–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤ (debug, logger)
3. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ DTO
4. –ü–µ—Ä–µ–¥–∞—á–∞ DTO –≤ Renderer/–≤–∏–¥–∂–µ—Ç—ã

–≠—Ç–æ –¥–∞—Å—Ç –≤–∞–º:
- ‚úÖ –ü–æ–ª–Ω—É—é —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –°–ª–∞–±—É—é —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å
- ‚úÖ –õ—ë–≥–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω—è—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –Ø–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
