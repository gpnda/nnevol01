# Инструкция по тестированию SpambiteExperiment

## Предварительные проверки

Перед запуском убедитесь, что:

1. Python 3.9+ установлен
2. Все зависимости установлены:
   ```bash
   pip install pygame numpy numba
   ```
3. Вы находитесь в директории `c:\WORK\evol`

## Запуск приложения

```bash
python nnevol.py
```

Приложение откроет Pygame окно с симуляцией. Вы увидите:
- Основное окно с миром (grid с существами и едой)
- График популяции (право сверху)
- Гистограмму смертей (право внизу)
- Панель информации о выбранном существе

## Запуск SpambiteExperiment

### Шаг 1: Выбрать существо

**Способ 1: F1 - Список существ**
- Нажмите **F1** в основном окне
- Откроется модальное окно со списком существ
- Используйте стрелки **↑/↓** для навигации
- Нажмите **Enter** для выбора
- Нажмите **Escape** для закрытия

**Способ 2: TAB - Быстрый выбор**
- Нажмите **TAB** для выбора существа с максимальным ID
- Нажмите **TAB** еще раз для следующего по ID (в убыванию)
- Нажмите **Shift+TAB** для выбора в возрастании ID

**Способ 3: Кликнуть на существо**
- Нажмите **左 мышку** на существо в viewport
- Существо выделится (красная точка)

### Шаг 2: Запустить эксперимент

- Нажмите **F2** в основном окне
- Откроется окно со списком доступных экспериментов:
  - 0: Dummy Experiment
  - 1: SpambiteExperiment ← Нам нужно это
- Нажмите **↓** один раз (если не выбран) для выбора SpambiteExperiment
- Нажмите **Enter** для запуска

### Шаг 3: Наблюдать эксперимент

После запуска вы увидите:

**Левая часть (Map View):**
- 50x50 сетка (серая/синяя)
- Стены (темно-синие)
- Существо (красная точка) в центре
- Пищу (зеленая точка) где-то на карте

**Правая часть (Statistics):**
```
╔══ SpambiteExperiment ══╗
║                        ║
║ Iteration: 1/20        ║
║ Successes: 0           ║
║ Failures: 0            ║
║ Success Rate: 0.0%     ║
║                        ║
║ Progress: [========...]║
║ Frames: 15/300         ║
║                        ║
╚════════════════════════╝
```

**Динамика:**
- Существо будет двигаться к пище используя свою нейросеть
- Каждый фрейм обновляется счетчик frames и позиция
- После 300 фреймов БЕЗ найденной пищи → **Failure** → Новая итерация
- Если существо укусит пищу → **Success** → Новая итерация
- После 20 итераций → эксперимент завершается

### Шаг 4: Завершение

После завершения 20 итераций:
- Widget закроется
- В консоли появится:
  ```
  [EXPERIMENT] Results: 20 iterations completed
  Successes: X/20
  Success Rate: Y%
  Interpretation: [EXCELLENT/GOOD/MODERATE/POOR/VERY POOR]
  ```

Нажмите **Escape** в любой момент для прерывания эксперимента.

## Что проверять

### Визуализация
- [ ] Карта 50x50 отображается
- [ ] Существо (красная точка) в центре (25,25)
- [ ] Пища (зеленая точка) видна где-то
- [ ] Границы карты видны (темные стены)

### Динамика
- [ ] Существо движется каждый фрейм
- [ ] Счетчик frames увеличивается (0-300)
- [ ] Счетчик iterations переходит в новые числа (1-20)
- [ ] Когда существо достигает пищи:
  - Successes увеличивается на 1
  - Iteration переходит на +1
  - Creature и food появляются в новых местах

### Статистика
- [ ] Success Rate начинается с 0%
- [ ] Success Rate увеличивается по мере успехов
- [ ] Progress Bar медленно заполняется во время итерации
- [ ] После 20 итераций эксперимент завершается

### Консоль
- [ ] При выборе существа: `✓ Creature selected: id=XXX`
- [ ] При запуске: `✓ Experiment selected: spambite on creature XXX`
- [ ] При старте: `[EXPERIMENT] Starting SpambiteExperiment on creature XXX`
- [ ] При завершении: Выводится статистика с интерпретацией

## Скорость симуляции

### Если слишком медленно:
- Нажмите **A** для отключения рендеринга (симуляция продолжится без визуализации)
- Нажмите **A** еще раз для включения рендеринга

### Если слишком быстро:
- Renderer уже ограничивает до 60 FPS
- Это нормально - эксперимент работает как положено

## Отладка

### Если эксперимент не запускается:

1. **Ошибка: "Creature with ID XXX not found"**
   - Выбранное существо умерло
   - Решение: Выберите другое существо (F1)

2. **Ошибка: "Unknown experiment type"**
   - SpambiteExperiment не зарегистрирован в EXPERIMENTS
   - Решение: Проверьте experiments/__init__.py

3. **Окно не открывается**
   - Ошибка в widget.py или renderer.py
   - Решение: Проверьте консоль для деталей ошибки

### Если существо не движется:

Это может быть из-за нейросети. Попробуйте:
1. Выбрать другое существо
2. Запустить симуляцию несколько циклов (Space для pause/resume)
3. Некоторые существа более ленивые чем другие!

## Завершение тестирования

Нажмите **Escape** для закрытия эксперимента и возврата в основное окно.

Нажмите **Space** и закройте окно Pygame для выхода из приложения.

## Результаты тестирования

Когда вы протестируете SpambiteExperiment, обратите внимание на:

1. **Успеш ли эксперимент находит пищу?**
   - Если Success Rate > 50% - существо хорошо обучено
   - Если Success Rate < 20% - существо почти слепое

2. **Как быстро оно находит пищу?**
   - Frames в нижней части статистики показывает прогресс
   - Низкие значения → быстро найденная пища
   - Высокие значения (близко к 300) → трудно найти

3. **Стабильность**
   - Существо должно двигаться плавно
   - Карта должна обновляться без артефактов
   - Статистика должна обновляться без перепрыгивания

## Итоговый чек-лист ✓

После полного тестирования проверьте:

- [ ] SpambiteExperiment запускается без ошибок
- [ ] Widget отображается с картой 50x50
- [ ] Существо видно и движется
- [ ] Пища видна на карте
- [ ] Статистика обновляется каждый фрейм
- [ ] Успехи/неудачи отслеживаются корректно
- [ ] 20 итераций завершаются правильно
- [ ] ESC закрывает эксперимент
- [ ] Основная симуляция возобновляется
- [ ] Консоль выводит правильные сообщения

**ВСЕ ПУНКТЫ ПРОЙДЕНЫ? → ТЕСТИРОВАНИЕ УСПЕШНО ✓**

---

## Дополнительная информация

Для более подробной информации об архитектуре см:
- [ETAP7_RENDERER_INTEGRATION.md](ETAP7_RENDERER_INTEGRATION.md)
- [V3DTO_QUICK_START.md](V3DTO_QUICK_START.md)
- [Copilot Instructions](../.github/copilot-instructions.md)
