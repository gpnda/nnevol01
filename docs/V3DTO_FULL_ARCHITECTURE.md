# V3DTO - –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
c:\WORK\evol\
‚îú‚îÄ‚îÄ renderer/
‚îÇ   ‚îú‚îÄ‚îÄ v2/                          ‚Üê –°–¢–ê–†–ê–Ø –≤–µ—Ä—Å–∏—è (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ renderer.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gui_viewport.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gui_variablespanel.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gui_selected_creature.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gui_selected_creature_history.py
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ v3dto/                       ‚Üê –ù–û–í–ê–Ø –≤–µ—Ä—Å–∏—è (–ë–ï–ó –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç world/debug/logger)
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py              ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ API
‚îÇ       ‚îú‚îÄ‚îÄ dto.py                   ‚úÖ –í—Å–µ DTO –∫–ª–∞—Å—Å—ã (8 –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤)
‚îÇ       ‚îú‚îÄ‚îÄ renderer.py              ‚úÖ Renderer —Å factory –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è DTO
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ gui_viewport_example.py  ‚úÖ –ü–†–ò–ú–ï–† –∫–∞–∫ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å Viewport
‚îÇ       ‚îú‚îÄ‚îÄ gui_viewport.py          ‚è≥ TODO: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∏ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å
‚îÇ       ‚îú‚îÄ‚îÄ gui_variablespanel.py    ‚è≥ TODO: –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –¥–ª—è DTO
‚îÇ       ‚îú‚îÄ‚îÄ gui_selected_creature.py ‚è≥ TODO: –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –¥–ª—è DTO
‚îÇ       ‚îî‚îÄ‚îÄ gui_selected_creature_history.py ‚è≥ TODO: –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –¥–ª—è DTO
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE_ANALYSIS.md         ‚Üê –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
‚îÇ   ‚îú‚îÄ‚îÄ V3DTO_MIGRATION_GUIDE.md         ‚Üê –ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ V3DTO_QUICK_START.md            ‚Üê –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
‚îÇ   ‚îî‚îÄ‚îÄ V3DTO_FULL_ARCHITECTURE.md       ‚Üê –¢–´ –°–ï–ô–ß–ê–° –ß–ò–¢–ê–ï–®–¨ –≠–¢–û
‚îÇ
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ test_viewport_v3dto.py       ‚è≥ TODO: —é–Ω–∏—Ç —Ç–µ—Å—Ç—ã –¥–ª—è Viewport —Å DTO
    ‚îî‚îÄ‚îÄ test_dto_classes.py          ‚è≥ TODO: —é–Ω–∏—Ç —Ç–µ—Å—Ç—ã –¥–ª—è DTO
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ (–≤ v2)
```
Render —Å–ª–æ–π (GUI):
‚îú‚îÄ Viewport
‚îÇ  ‚îú‚îÄ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç: from service.debugger.debugger import debug  ‚ùå
‚îÇ  ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç: world –æ–±—ä–µ–∫—Ç                                    ‚ùå
‚îÇ  ‚îî‚îÄ –ó–Ω–∞–µ—Ç –æ: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö world                     ‚ùå
‚îÇ
‚îú‚îÄ VariablesPanel
‚îÇ  ‚îú‚îÄ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç: –Ω–∏—á–µ–≥–æ, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç world –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º       ‚ùå
‚îÇ  ‚îî‚îÄ –ó–∞–≤–∏—Å–∏—Ç –æ—Ç: –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ world                ‚ùå
‚îÇ
‚îú‚îÄ SelectedCreaturePanel
‚îÇ  ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç: world –æ–±—ä–µ–∫—Ç                                    ‚ùå
‚îÇ  ‚îî‚îÄ –í—ã–∑—ã–≤–∞–µ—Ç: world.get_creature_by_id()                     ‚ùå
‚îÇ
‚îî‚îÄ SelectedCreatureHistory
   ‚îú‚îÄ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç: from service.logger.logger import logme     ‚ùå
   ‚îî‚îÄ –í—ã–∑—ã–≤–∞–µ—Ç: logme.get_creature_energy_history()           ‚ùå

Domain Layer (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞):
‚îú‚îÄ World (—Å–æ–¥–µ—Ä–∂–∏—Ç creatures, foods, map)
‚îú‚îÄ Debugger (—Å–∏–Ω–≥–ª—Ç–æ–Ω —Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
‚îî‚îÄ Logger (—Å–∏–Ω–≥–ª—Ç–æ–Ω —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–æ–±—ã—Ç–∏–π)

–ü–†–û–ë–õ–ï–ú–ê: Render —Å–ª–æ–π –¢–ï–°–ù–û –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Domain —Å–ª–æ—é!
–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Viewport –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ world –∏ debugger.
```

### –†–µ—à–µ–Ω–∏–µ (–≤ v3dto)
```
Render —Å–ª–æ–π (GUI):
‚îú‚îÄ Viewport
‚îÇ  ‚îú‚îÄ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç: DTO –∫–ª–∞—Å—Å—ã —Ç–æ–ª—å–∫–æ                           ‚úÖ
‚îÇ  ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç: RenderStateDTO –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º                      ‚úÖ
‚îÇ  ‚îî‚îÄ –ó–Ω–∞–µ—Ç –æ: –¢–û–õ–¨–ö–û —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DTO                             ‚úÖ
‚îÇ
‚îú‚îÄ VariablesPanel
‚îÇ  ‚îú‚îÄ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç: DTO –∫–ª–∞—Å—Å—ã —Ç–æ–ª—å–∫–æ                           ‚úÖ
‚îÇ  ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç: RenderStateDTO                                 ‚úÖ
‚îÇ  ‚îî‚îÄ –ó–∞–≤–∏—Å–∏—Ç –æ—Ç: Callbacks —Å–∏—Å—Ç–µ–º–∞ (–Ω–µ direct world access)   ‚úÖ
‚îÇ
‚îú‚îÄ SelectedCreaturePanel
‚îÇ  ‚îú‚îÄ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç: DTO –∫–ª–∞—Å—Å—ã —Ç–æ–ª—å–∫–æ                           ‚úÖ
‚îÇ  ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç: RenderStateDTO                                 ‚úÖ
‚îÇ  ‚îî‚îÄ –í—ã–∑—ã–≤–∞–µ—Ç: —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥—ã DTO                              ‚úÖ
‚îÇ
‚îî‚îÄ SelectedCreatureHistory
   ‚îú‚îÄ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç: DTO –∫–ª–∞—Å—Å—ã —Ç–æ–ª—å–∫–æ                           ‚úÖ
   ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç: RenderStateDTO.selected_creature.history       ‚úÖ
   ‚îî‚îÄ –ë–ï–ó –∏–º–ø–æ—Ä—Ç–∞ logger —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞                             ‚úÖ

       ‚Üë DTO Layer (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
       ‚îÇ
Renderer (–º–µ–¥–∏–∞—Ç–æ—Ä –º–µ–∂–¥—É Domain –∏ Render)
‚îú‚îÄ _prepare_world_dto()              ‚Üê world ‚Üí WorldStateDTO
‚îú‚îÄ _prepare_debug_dto()              ‚Üê debug ‚Üí DebugDataDTO
‚îú‚îÄ _prepare_simulation_params_dto()  ‚Üê simparams ‚Üí SimulationParamsDTO
‚îú‚îÄ _prepare_creature_history_dto()   ‚Üê logger ‚Üí CreatureHistoryDTO
‚îî‚îÄ _prepare_render_state_dto()       ‚Üê –í–°–ï –î–ê–ù–ù–´–ï ‚Üí RenderStateDTO

Domain Layer (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞):
‚îú‚îÄ World (—Å–æ–¥–µ—Ä–∂–∏—Ç creatures, foods, map)
‚îú‚îÄ Debugger (—Å–∏–Ω–≥–ª—Ç–æ–Ω —Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
‚îî‚îÄ Logger (—Å–∏–Ω–≥–ª—Ç–æ–Ω —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–æ–±—ã—Ç–∏–π)

–ü–†–ï–ò–ú–£–©–ï–°–¢–í–û: Render —Å–ª–æ–π –ü–û–õ–ù–û–°–¢–¨–Æ –æ—Ç–¥–µ–ª–µ–Ω –æ—Ç Domain —Å–ª–æ—è!
–ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Viewport —Å mock DTO –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ world.
```

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ DTO –∫–ª–∞—Å—Å—ã

### 1. **CreatureDTO** - –î–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞
```python
@dataclass
class CreatureDTO:
    id: int
    x: float
    y: float
    angle: float
    energy: float
    age: int
    speed: float
    generation: int
    bite_effort: float
    vision_distance: float
    bite_range: float
```
**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** SelectedCreaturePanel, Viewport (–¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏)

### 2. **WorldStateDTO** - –°–Ω–∏–º–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏—Ä–∞
```python
@dataclass
class WorldStateDTO:
    map: np.ndarray
    width: int
    height: int
    creatures: List[CreatureDTO]
    foods: List[FoodDTO]
    tick: int
    
    # –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
    get_creature_by_id(creature_id)
    get_creature_at_position(x, y, radius)
```
**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** Viewport, (–≤ –±—É–¥—É—â–µ–º) FunctionKeysPanel

### 3. **CreatureHistoryDTO** - –ò—Å—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤–∞
```python
@dataclass
class CreatureHistoryDTO:
    creature_id: int
    energy_history: List[float]
    events: List[CreatureEventDTO]
    
    # –°–≤–æ–π—Å—Ç–≤–∞
    energy_min, energy_max, energy_current, lifespan
```
**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** SelectedCreatureHistory

### 4. **DebugDataDTO** - –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```python
@dataclass
class DebugDataDTO:
    raycast_dots: Optional[np.ndarray]
    all_visions: Optional[np.ndarray]
    all_outs: Optional[np.ndarray]
    
    # –ú–µ—Ç–æ–¥—ã
    is_empty() ‚Üí bool
```
**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** Viewport (–ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ)

### 5. **SimulationParamsDTO** - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏–º—É–ª—è—Ü–∏–∏
```python
@dataclass
class SimulationParamsDTO:
    mutation_probability: float
    mutation_strength: float
    creature_max_age: int
    food_amount: int
    # ... –∏ –µ—â–µ 10+ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    is_running: bool
    is_animating: bool
    is_logging: bool
```
**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** VariablesPanel

### 6. **RenderStateDTO** - –ì–õ–ê–í–ù–´–ô DTO –¥–ª—è –≤—Å–µ—Ö –≤–∏–¥–∂–µ—Ç–æ–≤
```python
@dataclass
class RenderStateDTO:
    world: WorldStateDTO
    params: SimulationParamsDTO
    debug: DebugDataDTO
    selected_creature: Optional[SelectedCreaturePanelDTO]
    current_state: str
    tick: int
    fps: int
    
    # –°–≤–æ–π—Å—Ç–≤–∞
    population_count, food_count, is_selected_alive
```
**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** –í—Å–µ –≤–∏–¥–∂–µ—Ç—ã (–≥–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞)

---

## üìä –ü–æ—Ç–æ–∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Application.run()                                    ‚îÇ
‚îÇ ‚îú‚îÄ world.update()                                   ‚îÇ
‚îÇ ‚îú‚îÄ world.update_map()                               ‚îÇ
‚îÇ ‚îî‚îÄ renderer.draw()  ‚Üê –í—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Renderer.draw()                                      ‚îÇ
‚îÇ ‚îú‚îÄ _prepare_render_state_dto()  ‚Üê –ì–õ–ê–í–ù–û–ï –ü–†–ï–û–ë–†–ê–ó–û ‚îÇ
‚îÇ ‚îÇ  ‚îú‚îÄ _prepare_world_dto()                          ‚îÇ
‚îÇ ‚îÇ  ‚îÇ  ‚îî‚îÄ world ‚Üí WorldStateDTO                      ‚îÇ
‚îÇ ‚îÇ  ‚îú‚îÄ _prepare_debug_dto()                          ‚îÇ
‚îÇ ‚îÇ  ‚îÇ  ‚îî‚îÄ debug singleton ‚Üí DebugDataDTO             ‚îÇ
‚îÇ ‚îÇ  ‚îú‚îÄ _prepare_simulation_params_dto()              ‚îÇ
‚îÇ ‚îÇ  ‚îÇ  ‚îî‚îÄ simparams ‚Üí SimulationParamsDTO            ‚îÇ
‚îÇ ‚îÇ  ‚îî‚îÄ _prepare_selected_creature_dto()              ‚îÇ
‚îÇ ‚îÇ     ‚îî‚îÄ logger + world ‚Üí CreatureHistoryDTO        ‚îÇ
‚îÇ ‚îÇ                                                    ‚îÇ
‚îÇ ‚îÇ  ‚ö†Ô∏è –¢–û–õ–¨–ö–û –ó–î–ï–°–¨ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ—Å—Ç—É–ø –∫ world/      ‚îÇ
‚îÇ ‚îÇ     debug/logger —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞–º!                      ‚îÇ
‚îÇ ‚îÇ                                                    ‚îÇ
‚îÇ ‚îî‚îÄ‚Üí RenderStateDTO (–≥–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–¥–∞—á–µ)              ‚îÇ
‚îÇ                                                     ‚îÇ
‚îú‚îÄ if state == 'main':                                ‚îÇ
‚îÇ  ‚îî‚îÄ _draw_main(render_state)                        ‚îÇ
‚îÇ     ‚îú‚îÄ viewport.draw(screen, render_state)         ‚îÇ
‚îÇ     ‚îú‚îÄ selected_creature_panel.draw(...)           ‚îÇ
‚îÇ     ‚îî‚îÄ selected_creature_history.draw(...)         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Viewport.draw(screen, render_state)                 ‚îÇ
‚îÇ ‚îú‚îÄ world_dto = render_state.world                   ‚îÇ
‚îÇ ‚îú‚îÄ debug_dto = render_state.debug                   ‚îÇ
‚îÇ ‚îú‚îÄ _draw_cells(world_dto)                           ‚îÇ
‚îÇ ‚îú‚îÄ _draw_raycasts(debug_dto.raycast_dots)          ‚îÇ
‚îÇ ‚îî‚îÄ pygame.display.flip()                            ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ ‚ö†Ô∏è Viewport –ù–ï –∑–Ω–∞–µ—Ç –æ world/debug —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞—Ö!      ‚îÇ
‚îÇ    –¢–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å DTO –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º                ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ DTO –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **–°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å (Loose Coupling)**
```python
# ‚ùå v2: Viewport –ø—Ä—è–º–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç world
class Viewport:
    def __init__(self, world):
        self.world = world  # Tight coupling!

# ‚úÖ v3dto: Viewport –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç DTO
class Viewport:
    def __init__(self):
        pass  # No dependency!
    
    def draw(self, screen, render_state):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º render_state.world, –Ω–µ self.world
```

### 2. **–ü–æ–ª–Ω–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å (100% Testability)**
```python
# ‚ùå v2: –ù—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π world –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Viewport
def test_viewport_v2():
    world = WorldGenerator.generate_world(100, 50, ...)  # –î–æ–ª–≥–æ!
    viewport = Viewport(world)
    viewport.draw(screen, font)

# ‚úÖ v3dto: –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å mock DTO
def test_viewport_v3dto():
    mock_world_dto = WorldStateDTO(
        map=np.zeros((10, 10)),
        creatures=[CreatureDTO(id=1, x=5, y=5, ...)],
        foods=[],
        ...
    )
    render_state = RenderStateDTO(world=mock_world_dto, ...)
    
    viewport = Viewport()
    viewport.draw(screen, render_state)  # –ë—ã—Å—Ç—Ä–æ!
```

### 3. **–Ø–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (Explicit Contracts)**
```python
# ‚ùå v2: –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã Viewport
def draw(self, screen, font, selected_creature_id=None, ...):
    # –ö–∞–∫–∏–µ –µ—â–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å?

# ‚úÖ v3dto: –Ø–≤–Ω–æ –≤–∏–¥–Ω–æ —á—Ç–æ –Ω—É–∂–Ω–æ Viewport
def draw(self, screen: pygame.Surface, render_state: RenderStateDTO) -> None:
    # IDE –ø–æ–¥—Å–∫–∞–∂–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è –≤ render_state
    render_state.world.creatures
    render_state.world.foods
    render_state.debug.raycast_dots
    # ... –∏ —Ç.–¥.
```

### 4. **–ì–∏–±–∫–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö (Data Source Flexibility)**
```python
# ‚ùå v2: Viewport –∂–µ—Å—Ç–∫–æ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ world –æ–±—ä–µ–∫—Ç—É
class Viewport:
    def __init__(self, world):
        self.world = world  # –¢–æ–ª—å–∫–æ –º–∏—Ä, –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ

# ‚úÖ v3dto: –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
# –í–∞—Ä–∏–∞–Ω—Ç 1: –†–µ–∞–ª—å–Ω—ã–π –º–∏—Ä
world_dto = renderer._prepare_world_dto()

# –í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –∏–≥—Ä–∞
saved_world_dto = load_from_file("game.save")

# –í–∞—Ä–∏–∞–Ω—Ç 3: Replay
replay_world_dto = replay_manager.get_world_at_tick(50)

# –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ Viewport!
viewport.draw(screen, RenderStateDTO(world=world_dto, ...))
```

### 5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (Scalability)**
```python
# ‚ùå v2: –ö–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
class MyNewWidget:
    def __init__(self, world, debugger, logger, app, ...):
        self.world = world
        self.debugger = debugger
        self.logger = logger
        self.app = app
        # –ú–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!

# ‚úÖ v3dto: –ö–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä
class MyNewWidget:
    def __init__(self):
        pass  # –ù–∏–∫–∞–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    
    def draw(self, screen, render_state):
        # render_state —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–ï —á—Ç–æ –Ω—É–∂–Ω–æ
        pass
```

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å v2 –Ω–∞ v3dto

### –®–∞–≥ 1: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```python
# v2 –æ—Å—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –µ—Å—Ç—å
from renderer.v2.renderer import Renderer as RendererV2

# v3dto —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
from renderer.v3dto.renderer import Renderer as RendererV3DTO

# –í application.py –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ñ–∏–≥
if USE_V3DTO:
    renderer = RendererV3DTO(world, app)
else:
    renderer = RendererV2(world, app)
```

### –®–∞–≥ 2: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ –≤–∏–¥–∂–µ—Ç–æ–≤
1. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å Viewport (—Å–∞–º—ã–π –∫—Ä–∏—Ç–∏—á–Ω—ã–π)
2. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å SelectedCreatureHistory (—É–±—Ä–∞—Ç—å logger)
3. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å SelectedCreaturePanel (–ø—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞)
4. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å VariablesPanel (—Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π)

### –®–∞–≥ 3: –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞
```python
# –ö–æ–≥–¥–∞ –≤—Å–µ –≤–∏–¥–∂–µ—Ç—ã –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã:
from renderer.v3dto.renderer import Renderer

# –£–¥–∞–ª–∏—Ç—å v2
# rm -r renderer/v2
```

---

## üìù –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è v3dto

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|---------|
| `__init__.py` | ‚úÖ –ì–û–¢–û–í–û | –ü—É–±–ª–∏—á–Ω—ã–π API v3dto |
| `dto.py` | ‚úÖ –ì–û–¢–û–í–û | –í—Å–µ DTO –∫–ª–∞—Å—Å—ã (CreatureDTO, WorldStateDTO, –∏ —Ç.–¥.) |
| `renderer.py` | ‚úÖ –ì–û–¢–û–í–û | –ì–ª–∞–≤–Ω—ã–π Renderer —Å factory –º–µ—Ç–æ–¥–∞–º–∏ |
| `gui_viewport_example.py` | ‚úÖ –ì–û–¢–û–í–û | –ü–†–ò–ú–ï–† –∫–∞–∫ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å Viewport |
| `gui_viewport.py` | ‚è≥ TODO | Viewport —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π RenderStateDTO |
| `gui_variablespanel.py` | ‚è≥ TODO | VariablesPanel —Å —Å–∏—Å—Ç–µ–º–æ–π callbacks |
| `gui_selected_creature.py` | ‚è≥ TODO | SelectedCreaturePanel —Å DTO |
| `gui_selected_creature_history.py` | ‚è≥ TODO | SelectedCreatureHistory —Å DTO |

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–¥–ª—è —Ç–µ–±—è)

### –°–µ–π—á–∞—Å (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞):
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ v3dto
2. ‚úÖ –°–æ–∑–¥–∞–Ω—ã –≤—Å–µ DTO –∫–ª–∞—Å—Å—ã (dto.py)
3. ‚úÖ –°–æ–∑–¥–∞–Ω Renderer —Å factory –º–µ—Ç–æ–¥–∞–º–∏ (renderer.py)
4. ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–ø–∏—Å–∫–∏ Viewport (gui_viewport_example.py)
5. ‚úÖ –ù–∞–ø–∏—Å–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–∞–ª—å—à–µ (–ø–µ—Ä–µ–ø–∏—Å–∫–∞ –≤–∏–¥–∂–µ—Ç–æ–≤):
1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∏–∑ gui_viewport.py (v2) –≤ v3dto/gui_viewport.py
2. –ó–∞–º–µ–Ω–∏—Ç—å `self.world` –Ω–∞ `render_state.world`
3. –ó–∞–º–µ–Ω–∏—Ç—å `debug.get()` –Ω–∞ `render_state.debug.*`
4. –£–¥–∞–ª–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã debugger —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞
5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ó–∞—Ç–µ–º (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è):
1. –û–±–Ω–æ–≤–∏—Ç—å renderer.py —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã
2. –û–±–Ω–æ–≤–∏—Ç—å application.py –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å v3dto.Renderer
3. –£–¥–∞–ª–∏—Ç—å v2 –µ—Å–ª–∏ –æ–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞

---

## üí° –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. Renderer - —ç—Ç–æ –º–µ–¥–∏–∞—Ç–æ—Ä
```python
# Renderer –ø–æ–ª—É—á–∞–µ—Ç "–≥—Ä—è–∑–Ω—ã–µ" –¥–∞–Ω–Ω—ã–µ –∏–∑ Domain Layer
world      # –°–ª–æ–∂–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –º–µ—Ç–æ–¥–æ–≤
debug      # –°–∏–Ω–≥–ª—Ç–æ–Ω —Å —Å–ª—É—á–∞–π–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
logger     # –°–∏–Ω–≥–ª—Ç–æ–Ω —Å –∏—Å—Ç–æ—Ä–∏–µ–π

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏—Ö –≤ "—á–∏—Å—Ç—ã–µ" DTO –¥–ª—è Presentation Layer
RenderStateDTO(
    world=WorldStateDTO(...),      # –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ
    debug=DebugDataDTO(...),       # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    ...
)
```

### 2. –í–∏–¥–∂–µ—Ç—ã - —ç—Ç–æ "—Ç—É–ø—ã–µ" –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
```python
# –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (v2):
# Viewport –¥–æ–ª–∂–Ω–∞ —É–º–µ—Ç—å: –Ω–∞–π—Ç–∏ creatures –≤ world, –ø–æ–ª—É—á–∏—Ç—å raycast –∏–∑ debug, –∏ —Ç.–¥.
# Viewport –æ–±—è–∑–∞–Ω–∞ –∑–Ω–∞—Ç—å –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ world

# –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (v3dto):
# Viewport —Ç–æ–ª—å–∫–æ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Ç–æ —á—Ç–æ –µ–π –¥–∞–Ω–æ –≤ render_state
# Viewport –Ω–µ –∑–Ω–∞–µ—Ç –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ
```

### 3. RenderStateDTO - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```python
# –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
viewport.draw(screen, font, world, debugger, selected_id, app, ...)

# –ü–µ—Ä–µ–¥–∞–µ–º –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–ï –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ:
viewport.draw(screen, render_state)
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[ARCHITECTURE_ANALYSIS.md](ARCHITECTURE_ANALYSIS.md)** - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
- **[V3DTO_MIGRATION_GUIDE.md](V3DTO_MIGRATION_GUIDE.md)** - –ü–æ—à–∞–≥–æ–≤—ã–π –≥–∞–π–¥ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
- **[V3DTO_QUICK_START.md](V3DTO_QUICK_START.md)** - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## ‚úÖ –ò—Ç–æ–≥–æ

‚ú® **v3dto - —ç—Ç–æ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å —Ü–µ–ª—å—é:**
- –ü–æ–ª–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–∏ Domain Logic –æ—Ç Presentation Logic
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DTO –¥–ª—è —è–≤–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
- –ü–æ–ª–Ω–æ–π —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç–æ–≤ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ì–∏–±–∫–æ—Å—Ç–∏ –¥–ª—è —Å–º–µ–Ω—ã –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

üí™ **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞, –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã!**
