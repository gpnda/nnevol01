# üîÑ v1 vs v3dto –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

## –û–±–∑–æ—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | v1 (gui_creatures_popup.py) | v3dto (gui_creatures_list.py) | –£–ª—É—á—à–µ–Ω–∏–µ |
|---|---|---|---|
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç world** | ‚úó –ü—Ä—è–º–∞—è | ‚úì –ß–µ—Ä–µ–∑ RenderStateDTO | -100% —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ |
| **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚úó –°–ª–æ–∂–Ω–∞—è | ‚úì –ü—Ä–æ—Å—Ç–∞—è | ‚àû |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤** | 1 (world) | 0 | -100% |
| **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã __init__** | 1 (world) | 0 | -100% |
| **–í–∏–¥–∏–º–æ—Å—Ç—å** | ‚úó –ß–µ—Ä–µ–∑ —Ñ–ª–∞–≥ | ‚úì –ß–µ—Ä–µ–∑ state machine | –Ø–≤–Ω–∞—è |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π** | ‚úó –°–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç | ‚úì Callback methods | –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** | ‚úó –°–ª–æ–∂–Ω–∞—è | ‚úì –ü—Ä–æ—Å—Ç–∞—è | –ü–∞—Ç—Ç–µ—Ä–Ω—ã v3dto |
| **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å** | ‚úó –°–≤—è–∑–∞–Ω–æ —Å Renderer v1 | ‚úì –ù–µ–∑–∞–≤–∏—Å–∏–º–∞ | –ü–æ—Ä—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ (–î–∏–∞–≥—Ä–∞–º–º–∞)

### v1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å—Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω–∞)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Renderer v1                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ CreaturesPopup                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - self.world                     ‚îÇ  ‚îÇ ‚óÑ‚îÄ‚îÄ –°–∏–Ω–≥–ª—Ç–æ–Ω
‚îÇ  ‚îÇ  - self.visible                   ‚îÇ  ‚îÇ     World
‚îÇ  ‚îÇ  - handle_event()                 ‚îÇ  ‚îÇ     (z–∞–≤–∏—Å–∏—Ç)
‚îÇ  ‚îÇ  - draw(screen)                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ world.creatures   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ           ‚Üì (–∑–∞–≤–∏—Å–∏—Ç)                   ‚îÇ
‚îÇ        World (—Å–∏–Ω–≥–ª—Ç–æ–Ω)                 ‚îÇ
‚îÇ        - creatures[]                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü—Ä–æ–±–ª–µ–º—ã:
- CreaturesPopup –∑–Ω–∞–µ—Ç –æ World
- World –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è ‚Üí –Ω—É–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ CreaturesPopup
- –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (–Ω—É–∂–µ–Ω mock World)
- –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
```

### v3dto –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å–ª–∞–±–æ —Å–≤—è–∑–∞–Ω–∞)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Renderer v3dto                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ   World          ‚îÇ        ‚îÇ CreaturesListModal   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - creatures     ‚îÇ        ‚îÇ  - NO SINGLETONS!    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - foods         ‚îÇ        ‚îÇ  - __init__() clean  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - map           ‚îÇ        ‚îÇ  - draw() pure       ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ  - navigation clean  ‚îÇ   ‚îÇ
‚îÇ         ‚Üì                     ‚îÇ  (–ü–æ–ª–Ω–æ—Å—Ç—å—é          ‚îÇ   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ   –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞)       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  RenderStateDTO      ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - world: WorldDTO   ‚îÇ    ‚îÇ  RenderStateDTO      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - params: ParamsDTO ‚îÇ    ‚îÇ  - world.creatures   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - debug: DebugDTO   ‚îÇ    ‚îÇ  - –≤—Å—ë —á—Ç–æ –Ω—É–∂–Ω–æ     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ         ‚Üì                                                 ‚îÇ
‚îÇ    –í–∏–¥–∂–µ—Ç—ã –ø–æ–ª—É—á–∞—é—Ç —Ç–æ–ª—å–∫–æ DTO                           ‚îÇ
‚îÇ    (ZERO –∑–Ω–∞–Ω–∏—è –æ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞—Ö)                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- CreaturesListModal –Ω–µ –∑–Ω–∞–µ—Ç –æ World
- –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º DTO
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (mock RenderStateDTO)
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```

## –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

### v1: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç World

```python
# –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (v1)
class Renderer:
    def __init__(self):
        self.world = World()
        self.creatures_popup = CreaturesPopup(self.world)  # ‚óÑ‚îÄ‚îÄ –ü–µ—Ä–µ–¥–∞—ë–º world
        # CreaturesPopup –∑–Ω–∞–µ—Ç –æ world –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –í–∏–¥–∂–µ—Ç —Å–≤—è–∑–∞–Ω —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π World
- –ï—Å–ª–∏ World –∏–∑–º–µ–Ω–∏—Ç—Å—è ‚Üí –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å CreaturesPopup
- –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å CreaturesPopup –±–µ–∑ World
- –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö

### v3dto: –ß–∏—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
# –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (v3dto)
class Renderer:
    def __init__(self):
        self.world = World()
        self.creatures_list_modal = CreaturesListModal()  # ‚óÑ‚îÄ‚îÄ –ë–ï–ó –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤!
        # CreaturesListModal –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç –æ world
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –í–∏–¥–∂–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω
- –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±—ã–º RenderStateDTO
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –±–µ–∑ world
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

## –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

### v1: –í–∏–¥–∂–µ—Ç —Å–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

```python
# v1 (gui_creatures_popup.py)
class CreaturesPopup:
    def handle_event(self, event: pygame.event.Event) -> bool:
        """–í–∏–¥–∂–µ—Ç —Å–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï —Å–æ–±—ã—Ç–∏—è."""
        if event.key == pygame.K_UP:
            if self.selected_index > 0:
                self.selected_index -= 1
                if self.selected_index < self.scroll_offset:
                    self.scroll_offset = self.selected_index
            return True
        
        elif event.key == pygame.K_DOWN:
            if self.selected_index < len(self.world.creatures) - 1:  # ‚óÑ‚îÄ‚îÄ –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ world!
                self.selected_index += 1
                if self.selected_index >= self.scroll_offset + self.MAX_VISIBLE_ROWS:
                    self.scroll_offset = self.selected_index - self.MAX_VISIBLE_ROWS + 1
            return True
        
        elif event.key == pygame.K_F1:
            self.toggle()  # ‚óÑ‚îÄ‚îÄ –°–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å—é
            return True
        
        # ... –µ—â—ë 20 —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π ...

# –í Renderer:
def control_run(self):
    for event in pygame.event.get():
        if event.type == pygame.KEYDOWN:
            self.creatures_popup.handle_event(event)  # ‚óÑ‚îÄ‚îÄ –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –í–∏–¥–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç logic —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –í–∏–¥–∂–µ—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç World (len(self.world.creatures))
- –¢—Ä—É–¥–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- State machine (–≤–∏–¥–∏–º–æ—Å—Ç—å) –≤–Ω—É—Ç—Ä–∏ –≤–∏–¥–∂–µ—Ç–∞
- –°–ª–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏

### v3dto: Renderer —É–ø—Ä–∞–≤–ª—è–µ—Ç, –≤–∏–¥–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã

```python
# v3dto (gui_creatures_list.py)
class CreaturesListModal:
    def move_selection_up(self, creatures_count: int) -> None:
        """–¢–û–õ–¨–ö–û –õ–û–ì–ò–ö–ê –ù–ê–í–ò–ì–ê–¶–ò–ò - –ë–ï–ó –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!"""
        if creatures_count == 0:
            return
        if self.selected_index > 0:
            self.selected_index -= 1
            if self.selected_index < self.scroll_offset:
                self.scroll_offset = self.selected_index
    
    def move_selection_down(self, creatures_count: int) -> None:
        """–¢–û–õ–¨–ö–û –õ–û–ì–ò–ö–ê - –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–∑–≤–Ω–µ!"""
        if creatures_count == 0:
            return
        if self.selected_index < creatures_count - 1:  # ‚óÑ‚îÄ‚îÄ –ü–∞—Ä–∞–º–µ—Ç—Ä, –Ω–µ world!
            self.selected_index += 1
            if self.selected_index >= self.scroll_offset + self.MAX_VISIBLE_ROWS:
                self.scroll_offset = self.selected_index - self.MAX_VISIBLE_ROWS + 1
    
    def reset(self) -> None:
        """–°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è Renderer'–æ–º)."""
        self.scroll_offset = 0
        self.selected_index = 0

# –í Renderer:
def _handle_keyboard_creatures_list(self, event: pygame.event.Event) -> bool:
    """Renderer –ü–û–õ–ù–û–°–¢–¨–Æ –ö–û–ù–¢–†–û–õ–ò–†–£–ï–¢ –ø–æ—Ç–æ–∫."""
    creatures_count = len(self.world.creatures)  # ‚óÑ‚îÄ‚îÄ Renderer –∑–Ω–∞–µ—Ç –æ world
    
    if event.key == pygame.K_UP:
        self.creatures_list_modal.move_selection_up(creatures_count)  # ‚óÑ‚îÄ‚îÄ –ü–µ—Ä–µ–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ
        return True
    
    elif event.key == pygame.K_DOWN:
        self.creatures_list_modal.move_selection_down(creatures_count)
        return True
    
    elif event.key in (pygame.K_ESCAPE, pygame.K_F1):
        self.set_state('main')  # ‚óÑ‚îÄ‚îÄ Renderer —É–ø—Ä–∞–≤–ª—è–µ—Ç state machine
        return True
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –í–∏–¥–∂–µ—Ç - —á–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ (functions-like)
- Renderer - –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ (business logic)
- –í–∏–¥–∂–µ—Ç –Ω–µ –∑–Ω–∞–µ—Ç –æ World
- –õ–µ–≥–∫–æ –≤–∏–¥–µ—Ç—å –ª–æ–≥–∏–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç

## –û—Ç—Ä–∏—Å–æ–≤–∫–∞

### v1: –í–∏–¥–∂–µ—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ World

```python
# v1 (gui_creatures_popup.py)
def draw(self, screen: pygame.Surface) -> None:
    """–í–∏–¥–∂–µ—Ç –ü–†–Ø–ú–û –û–ë–†–ê–©–ê–ï–¢–°–Ø –∫ world."""
    if not self.visible:  # ‚óÑ‚îÄ‚îÄ –°–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å—é
        return
    
    creatures = self.world.creatures  # ‚óÑ‚îÄ‚îÄ –ó–∞–≤–∏—Å–∏—Ç –æ—Ç world!
    creatures_count = len(self.world.creatures)
    
    # ... —Ä–∏—Å–æ–≤–∞–Ω–∏–µ ...
    for creature in creatures:  # ‚óÑ‚îÄ‚îÄ –ò—Ç–µ—Ä–∏—Ä—É–µ—Ç world.creatures
        # ... —Ä–∏—Å–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ ...
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –í–∏–¥–∂–µ—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É —Å–∏–Ω–≥–ª—Ç–æ–Ω—É World
- –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å mock –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ–ª—å–∑—è –æ—Ç–∫–ª—é—á–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ state machine
- –í–∏–¥–∂–µ—Ç –∑–Ω–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ

### v3dto: –í–∏–¥–∂–µ—Ç –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ DTO

```python
# v3dto (gui_creatures_list.py)
def draw(self, screen: pygame.Surface, render_state: 'RenderStateDTO') -> None:
    """–í–∏–¥–∂–µ—Ç –ü–û–õ–£–ß–ê–ï–¢ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ RenderStateDTO."""
    # –í–∏–¥–∏–º–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Renderer (–Ω–µ —Ä–∏—Å—É–µ—Ç—Å—è, –µ—Å–ª–∏ –Ω–µ –≤ —ç—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏)
    
    creatures = render_state.world.creatures  # ‚óÑ‚îÄ‚îÄ –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ DTO!
    creatures_count = len(creatures)
    
    # ... —Ä–∏—Å–æ–≤–∞–Ω–∏–µ ...
    for creature in creatures:  # ‚óÑ‚îÄ‚îÄ –ò—Ç–µ—Ä–∏—Ä—É–µ—Ç DTO creatures
        # ... —Ä–∏—Å–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ ...
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –í–∏–¥–∂–µ—Ç –ø–æ–ª—É—á–∞–µ—Ç DTO, –Ω–µ –∑–Ω–∞–µ—Ç –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–µ
- –õ–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –í–∏–¥–∏–º–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Renderer
- –í–∏–¥–∂–µ—Ç = pure view logic
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### v1: –û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ–µ

```python
# v1 - –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å?
import pytest
from renderer.v1.gui_creatures_popup import CreaturesPopup
from world import World

def test_creatures_popup_navigation():
    """–°–ª–æ–∂–Ω—ã–π —Ç–µ—Å—Ç - –Ω—É–∂–Ω–∞ —Ä–µ–∞–ª—å–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è."""
    # –°–æ–∑–¥–∞—ë–º —Ä–µ–∞–ª—å–Ω—ã–π World - –ú–ï–î–õ–ï–ù–ù–û, –°–õ–û–ñ–ù–û
    world = World(width=100, height=100)
    world.creatures = [
        create_test_creature(id=0, x=10, y=20),
        create_test_creature(id=1, x=15, y=25),
    ]
    
    # –°–æ–∑–¥–∞—ë–º popup —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é
    popup = CreaturesPopup(world)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º
    event = create_key_event(pygame.K_DOWN)
    popup.handle_event(event)
    
    assert popup.selected_index == 1
    
    # –ü—Ä–æ–±–ª–µ–º—ã:
    # - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–π World —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    # - –ú–µ–¥–ª–µ–Ω–Ω–æ (—Ä–µ–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
    # - –•—Ä—É–ø–∫–æ (–µ—Å–ª–∏ World –∏–∑–º–µ–Ω–∏—Ç—Å—è ‚Üí —Ç–µ—Å—Ç —Å–ª–æ–º–∞–µ—Ç—Å—è)
    # - –°–ª–æ–∂–Ω–æ (–º–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
```

### v3dto: –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ

```python
# v3dto - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —Å—É–ø–µ—Ä –ø—Ä–æ—Å—Ç–æ!
import pytest
from renderer.v3dto.gui_creatures_list import CreaturesListModal
from renderer.v3dto.dto import RenderStateDTO, WorldStateDTO, CreatureDTO

def test_creatures_list_modal_navigation():
    """–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç - —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞."""
    # –°–æ–∑–¥–∞—ë–º MOCK RenderStateDTO
    modal = CreaturesListModal()
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ë–ï–ó world
    modal.move_selection_down(10)
    assert modal.selected_index == 1
    
    modal.move_selection_up(10)
    assert modal.selected_index == 0
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
    modal.move_selection_down(0)  # 0 —Å—É—â–µ—Å—Ç–≤
    assert modal.selected_index == 0  # –ù–µ –¥–≤–∏–∂–µ—Ç—Å—è
    
    # –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
    # - –ù–µ –Ω—É–∂–Ω–∞ Real World
    # - –ë–´–°–¢–†–û (—Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞)
    # - –ù–ê–î–Å–ñ–ù–û (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏)
    # - –ü–†–û–°–¢–û–ô –ö–û–î (–ø–æ–Ω—è—Ç–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
```

## –î–∏–∞–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### v1 (–ü–ª–æ—Ç–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

```
CreaturesPopup
    ‚Üì
    ‚îî‚îÄ‚Üí World (singleton)
        ‚îî‚îÄ‚Üí Creature objects
            ‚îî‚îÄ‚Üí Neural Network
                ‚îî‚îÄ‚Üí Numpy arrays
                    ‚îî‚îÄ‚Üí ...

‚úó –û–¥–Ω–∞ —Ü–µ–ø–æ—á–∫–∞ ‚Üí –≤–µ—Å—å —Å–ª–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```

### v3dto (–†—ã—Ö–ª—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

```
CreaturesListModal          RenderStateDTO
    ‚Üì                              ‚Üë
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ draw(render_state)
    
    ‚Ä¢ No dependencies to anything
    ‚Ä¢ Pure logic
    ‚Ä¢ Self-contained
    
    Renderer:
        ‚Üì
        ‚îî‚îÄ‚Üí World
        ‚îî‚îÄ‚Üí Logger
        ‚îî‚îÄ‚Üí Debugger
        ‚îî‚îÄ‚Üí SimParams
        
    (Renderer handles all singletons, widgets don't know about them)

‚úì –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å

### v1: –ü—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –æ–¥–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Renderer v1:
class Renderer:
    def __init__(self, world):
        self.creatures_popup = CreaturesPopup(world)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ?
# ‚úó –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ - –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ Renderer v1 –∏ World

# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã–π Renderer?
# ‚úó –°–ª–æ–∂–Ω–æ - –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –ª–æ–≥–∏–∫—É —Å–æ–±—ã—Ç–∏–π
```

### v3dto: –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Renderer v3dto:
class Renderer:
    def __init__(self, world, app):
        self.creatures_list_modal = CreaturesListModal()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ? (–Ω–∞–ø—Ä–∏–º–µ—Ä, CLI)
# ‚úì –í–æ–∑–º–æ–∂–Ω–æ!
class CLIApp:
    def __init__(self, render_state: RenderStateDTO):
        self.modal = CreaturesListModal()
        self.modal.draw(terminal_surface, render_state)

# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã–π Renderer?
# ‚úì –†–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏–π!

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ?
# ‚úì –õ–µ–≥–∫–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å render_state –≤ JSON –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å HTML
```

## –≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
v1 (2024):
CreaturesPopup(world)
‚îî‚îÄ –ñ—ë—Å—Ç–∫–æ —Å–≤—è–∑–∞–Ω–æ
‚îî‚îÄ –°–ª–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å

v2 (Early 2025):
–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤–∏—Ç—Ä–∏–Ω
‚îî‚îÄ –õ—É—á—à–µ, –Ω–æ modal state –µ—â—ë –≤ –≤–∏–¥–∂–µ—Ç–∞—Ö

v3dto (Current):
CreaturesListModal(NO PARAMS)
‚îî‚îÄ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è
‚îî‚îÄ State machine –≤ Renderer
‚îî‚îÄ DTO everywhere
‚îî‚îÄ –ì–æ—Ç–æ–≤–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
```

## –†–µ–∑—é–º–µ

| –ê—Å–ø–µ–∫—Ç | v1 | v3dto |
|--------|----|----|
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è | –ú–æ–¥—É–ª—å–Ω–∞—è |
| **–°–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** | –°–ª–æ–∂–Ω–∞—è | –ü—Ä–æ—Å—Ç–∞—è |
| **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å** | –ù–µ—Ç | –î–∞ |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | –ü–ª–æ—Ö–∞—è | –•–æ—Ä–æ—à–∞—è |
| **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** | –¢—Ä—É–¥–Ω–∞—è | –õ—ë–≥–∫–∞—è |
| **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** | –°–ª–æ–∂–Ω–∞—è | –ü—Ä–æ—Å—Ç–∞—è |

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: v3dto –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - —ç—Ç–æ —á–∏—Å—Ç–∞—è, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –±–∞–∑–∞ –¥–ª—è —Ä–æ—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞! üöÄ
